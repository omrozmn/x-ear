#!/usr/bin/env node
/**
 * Post-Orval script to generate index.ts in each tag directory
 * This ensures imports like '@/api/generated/auth/auth' work correctly
 */

import fs from 'fs';
import path from 'path';
import { fileURLToPath } from 'url';

const __filename = fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);

const GENERATED_DIR = path.join(__dirname, '../src/api/generated');

console.log('üîß Generating index.ts for each tag directory...');

// Get all subdirectories (tags)
const entries = fs.readdirSync(GENERATED_DIR, { withFileTypes: true });
const tagDirs = entries
  .filter(entry => entry.isDirectory() && entry.name !== 'schemas')
  .map(entry => entry.name)
  .sort();

console.log(`üìÅ Found ${tagDirs.length} tag directories`);

let created = 0;
let skipped = 0;

tagDirs.forEach(tag => {
  const tagDir = path.join(GENERATED_DIR, tag);
  const tagFile = path.join(tagDir, `${tag}.ts`);
  const indexFile = path.join(tagDir, 'index.ts');
  
  // Check if the tag file exists
  if (!fs.existsSync(tagFile)) {
    console.log(`‚ö†Ô∏è  Skipping ${tag}: ${tag}.ts not found`);
    skipped++;
    return;
  }
  
  // Generate index.ts content
  const indexContent = `/**
 * Auto-generated index file for ${tag}
 * Generated by scripts/generate-tag-indexes.mjs
 * DO NOT EDIT MANUALLY
 */

export * from './${tag}';
`;
  
  // Write index.ts
  fs.writeFileSync(indexFile, indexContent, 'utf-8');
  created++;
});

console.log(`‚úÖ Generated ${created} index.ts files`);
if (skipped > 0) {
  console.log(`‚ö†Ô∏è  Skipped ${skipped} directories`);
}
