#!/usr/bin/env node

/**
 * Auto-generate index.ts for Orval generated API
 * 
 * This script scans the generated folder and creates an index.ts
 * that exports all hooks and schemas.
 * 
 * Usage: node scripts/generate-api-index.mjs
 */

import { readdirSync, statSync, writeFileSync } from 'fs';
import { join, dirname } from 'path';
import { fileURLToPath } from 'url';

const __filename = fileURLToPath(import.meta.url);
const __dirname = dirname(__filename);

const GENERATED_DIR = join(__dirname, '../src/lib/api/generated');
const OUTPUT_FILE = join(GENERATED_DIR, 'index.ts');

console.log('üîç Scanning generated API folder...');

// Get all directories in generated folder (excluding schemas)
const entries = readdirSync(GENERATED_DIR);
const apiDirs = entries.filter(entry => {
  const fullPath = join(GENERATED_DIR, entry);
  return statSync(fullPath).isDirectory() && entry !== 'schemas';
});

console.log(`üìÅ Found ${apiDirs.length} API modules:`, apiDirs.join(', '));

// Generate exports
const exports = [];

// Add header comment
exports.push('/**');
exports.push(' * Auto-generated API Exports for Landing App');
exports.push(' * ');
exports.push(' * Generated by: scripts/generate-api-index.mjs');
exports.push(` * Generated at: ${new Date().toISOString()}`);
exports.push(' * ');
exports.push(' * DO NOT EDIT MANUALLY - This file is auto-generated');
exports.push(' * Run: npm run orval to regenerate');
exports.push(' */');
exports.push('');

// Export each API module
apiDirs.forEach(dir => {
  exports.push(`// ${dir.charAt(0).toUpperCase() + dir.slice(1)} API`);
  exports.push(`export * from './${dir}/${dir}';`);
  exports.push('');
});

// Export schemas
exports.push('// Schemas');
exports.push(`export * from './schemas';`);

// Write to file
const content = exports.join('\n');
writeFileSync(OUTPUT_FILE, content, 'utf-8');

console.log('‚úÖ Generated index.ts successfully!');
console.log(`üìù Exported ${apiDirs.length} API modules`);
console.log(`üìÑ Output: ${OUTPUT_FILE}`);
