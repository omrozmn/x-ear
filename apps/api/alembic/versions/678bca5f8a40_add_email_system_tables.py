"""add_email_system_tables

Revision ID: 678bca5f8a40
Revises: 9e4d614c2186
Create Date: 2026-01-23 23:06:33.251270

"""
from typing import Sequence, Union

from alembic import op
import sqlalchemy as sa


# revision identifiers, used by Alembic.
revision: str = '678bca5f8a40'
down_revision: Union[str, None] = '9e4d614c2186'
branch_labels: Union[str, Sequence[str], None] = None
depends_on: Union[str, Sequence[str], None] = None


def upgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    op.create_table('addons',
    sa.Column('id', sa.String(length=36), nullable=False),
    sa.Column('name', sa.String(length=255), nullable=False),
    sa.Column('slug', sa.String(length=100), nullable=False),
    sa.Column('description', sa.Text(), nullable=True),
    sa.Column('addon_type', sa.Enum('PER_USER', 'FLAT_FEE', 'USAGE_BASED', name='addontype'), nullable=False),
    sa.Column('price', sa.Numeric(precision=10, scale=2), nullable=False),
    sa.Column('currency', sa.String(length=3), nullable=False),
    sa.Column('unit_name', sa.String(length=50), nullable=True),
    sa.Column('limit_amount', sa.Integer(), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('created_at', sa.DateTime(), nullable=False),
    sa.Column('updated_at', sa.DateTime(), nullable=False),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_addons_name'), 'addons', ['name'], unique=False)
    op.create_index(op.f('ix_addons_slug'), 'addons', ['slug'], unique=True)
    op.create_table('admin_permissions',
    sa.Column('id', sa.String(length=36), nullable=False),
    sa.Column('code', sa.String(length=100), nullable=False),
    sa.Column('label', sa.String(length=200), nullable=False),
    sa.Column('description', sa.String(length=500), nullable=True),
    sa.Column('category', sa.String(length=50), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=False),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_admin_permissions_code'), 'admin_permissions', ['code'], unique=True)
    op.create_table('admin_roles',
    sa.Column('id', sa.String(length=36), nullable=False),
    sa.Column('name', sa.String(length=100), nullable=False),
    sa.Column('description', sa.String(length=500), nullable=True),
    sa.Column('is_system_role', sa.Boolean(), nullable=False),
    sa.Column('created_at', sa.DateTime(), nullable=False),
    sa.Column('updated_at', sa.DateTime(), nullable=True),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_admin_roles_name'), 'admin_roles', ['name'], unique=True)
    op.create_table('admin_users',
    sa.Column('id', sa.String(length=36), nullable=False),
    sa.Column('email', sa.String(length=255), nullable=False),
    sa.Column('password_hash', sa.String(length=255), nullable=False),
    sa.Column('first_name', sa.String(length=100), nullable=True),
    sa.Column('last_name', sa.String(length=100), nullable=True),
    sa.Column('role', sa.String(length=50), nullable=False),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('mfa_enabled', sa.Boolean(), nullable=True),
    sa.Column('mfa_secret', sa.String(length=100), nullable=True),
    sa.Column('last_login', sa.DateTime(), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=False),
    sa.Column('updated_at', sa.DateTime(), nullable=True),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_admin_users_email'), 'admin_users', ['email'], unique=True)
    op.create_table('affiliate_user',
    sa.Column('id', sa.Integer(), autoincrement=True, nullable=False),
    sa.Column('email', sa.String(length=255), nullable=False),
    sa.Column('password_hash', sa.String(length=255), nullable=False),
    sa.Column('iban', sa.String(length=34), nullable=True),
    sa.Column('account_holder_name', sa.String(length=255), nullable=True),
    sa.Column('phone_number', sa.String(length=20), nullable=True),
    sa.Column('code', sa.String(length=32), nullable=False),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=False),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('code')
    )
    op.create_index(op.f('ix_affiliate_user_email'), 'affiliate_user', ['email'], unique=True)
    op.create_table('ai_audit_logs',
    sa.Column('id', sa.String(length=64), nullable=False),
    sa.Column('tenant_id', sa.String(length=64), nullable=False),
    sa.Column('user_id', sa.String(length=64), nullable=False),
    sa.Column('request_id', sa.String(length=64), nullable=True),
    sa.Column('action_id', sa.String(length=64), nullable=True),
    sa.Column('session_id', sa.String(length=64), nullable=True),
    sa.Column('event_type', sa.String(length=32), nullable=False),
    sa.Column('event_timestamp', sa.DateTime(), nullable=False),
    sa.Column('intent_type', sa.String(length=32), nullable=True),
    sa.Column('intent_confidence', sa.Integer(), nullable=True),
    sa.Column('action_plan_hash', sa.String(length=64), nullable=True),
    sa.Column('risk_level', sa.String(length=16), nullable=True),
    sa.Column('outcome', sa.String(length=32), nullable=True),
    sa.Column('model_id', sa.String(length=64), nullable=True),
    sa.Column('model_version', sa.String(length=32), nullable=True),
    sa.Column('prompt_template_id', sa.String(length=64), nullable=True),
    sa.Column('prompt_template_version', sa.String(length=32), nullable=True),
    sa.Column('prompt_template_hash', sa.String(length=64), nullable=True),
    sa.Column('policy_version', sa.String(length=32), nullable=True),
    sa.Column('policy_rule_id', sa.String(length=64), nullable=True),
    sa.Column('policy_decision', sa.String(length=16), nullable=True),
    sa.Column('diff_snapshot', sa.JSON(), nullable=True),
    sa.Column('error_code', sa.String(length=32), nullable=True),
    sa.Column('error_message', sa.Text(), nullable=True),
    sa.Column('incident_tag', sa.String(length=32), nullable=True),
    sa.Column('incident_bundle_id', sa.String(length=64), nullable=True),
    sa.Column('extra_data', sa.JSON(), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=False),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_ai_audit_logs_action_id'), 'ai_audit_logs', ['action_id'], unique=False)
    op.create_index(op.f('ix_ai_audit_logs_event_type'), 'ai_audit_logs', ['event_type'], unique=False)
    op.create_index('ix_ai_audit_logs_event_type_timestamp', 'ai_audit_logs', ['event_type', 'event_timestamp'], unique=False)
    op.create_index(op.f('ix_ai_audit_logs_incident_bundle_id'), 'ai_audit_logs', ['incident_bundle_id'], unique=False)
    op.create_index('ix_ai_audit_logs_incident_tag', 'ai_audit_logs', ['incident_tag', 'event_timestamp'], unique=False)
    op.create_index(op.f('ix_ai_audit_logs_request_id'), 'ai_audit_logs', ['request_id'], unique=False)
    op.create_index('ix_ai_audit_logs_request_timestamp', 'ai_audit_logs', ['request_id', 'event_timestamp'], unique=False)
    op.create_index(op.f('ix_ai_audit_logs_tenant_id'), 'ai_audit_logs', ['tenant_id'], unique=False)
    op.create_index('ix_ai_audit_logs_tenant_timestamp', 'ai_audit_logs', ['tenant_id', 'event_timestamp'], unique=False)
    op.create_index(op.f('ix_ai_audit_logs_user_id'), 'ai_audit_logs', ['user_id'], unique=False)
    op.create_table('ai_requests',
    sa.Column('id', sa.String(length=64), nullable=False),
    sa.Column('tenant_id', sa.String(length=64), nullable=False),
    sa.Column('user_id', sa.String(length=64), nullable=False),
    sa.Column('session_id', sa.String(length=64), nullable=True),
    sa.Column('prompt_encrypted', sa.Text(), nullable=False),
    sa.Column('prompt_hash', sa.String(length=64), nullable=False),
    sa.Column('prompt_redacted', sa.Text(), nullable=True),
    sa.Column('intent_type', sa.String(length=32), nullable=True),
    sa.Column('intent_confidence', sa.Integer(), nullable=True),
    sa.Column('intent_data', sa.JSON(), nullable=True),
    sa.Column('model_id', sa.String(length=64), nullable=True),
    sa.Column('model_version', sa.String(length=32), nullable=True),
    sa.Column('prompt_template_id', sa.String(length=64), nullable=True),
    sa.Column('prompt_template_hash', sa.String(length=64), nullable=True),
    sa.Column('status', sa.String(length=20), nullable=False),
    sa.Column('error_message', sa.Text(), nullable=True),
    sa.Column('tokens_input', sa.Integer(), nullable=True),
    sa.Column('tokens_output', sa.Integer(), nullable=True),
    sa.Column('latency_ms', sa.Integer(), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=False),
    sa.Column('completed_at', sa.DateTime(), nullable=True),
    sa.Column('legal_hold', sa.Boolean(), nullable=False),
    sa.Column('idempotency_key', sa.String(length=128), nullable=True),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_ai_requests_created_at'), 'ai_requests', ['created_at'], unique=False)
    op.create_index(op.f('ix_ai_requests_idempotency_key'), 'ai_requests', ['idempotency_key'], unique=False)
    op.create_index(op.f('ix_ai_requests_legal_hold'), 'ai_requests', ['legal_hold'], unique=False)
    op.create_index('ix_ai_requests_legal_hold_created', 'ai_requests', ['legal_hold', 'created_at'], unique=False)
    op.create_index(op.f('ix_ai_requests_prompt_hash'), 'ai_requests', ['prompt_hash'], unique=False)
    op.create_index(op.f('ix_ai_requests_session_id'), 'ai_requests', ['session_id'], unique=False)
    op.create_index('ix_ai_requests_status_created', 'ai_requests', ['status', 'created_at'], unique=False)
    op.create_index('ix_ai_requests_tenant_created', 'ai_requests', ['tenant_id', 'created_at'], unique=False)
    op.create_index(op.f('ix_ai_requests_tenant_id'), 'ai_requests', ['tenant_id'], unique=False)
    op.create_index('ix_ai_requests_user_created', 'ai_requests', ['user_id', 'created_at'], unique=False)
    op.create_index(op.f('ix_ai_requests_user_id'), 'ai_requests', ['user_id'], unique=False)
    op.create_table('ai_usage',
    sa.Column('id', sa.String(length=64), nullable=False),
    sa.Column('tenant_id', sa.String(length=64), nullable=False),
    sa.Column('usage_date', sa.Date(), nullable=False),
    sa.Column('usage_type', sa.String(length=20), nullable=False),
    sa.Column('request_count', sa.Integer(), nullable=False),
    sa.Column('token_count_input', sa.Integer(), nullable=False),
    sa.Column('token_count_output', sa.Integer(), nullable=False),
    sa.Column('quota_limit', sa.Integer(), nullable=True),
    sa.Column('quota_exceeded_at', sa.DateTime(), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=False),
    sa.Column('updated_at', sa.DateTime(), nullable=False),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('tenant_id', 'usage_date', 'usage_type', name='uix_ai_usage_tenant_date_type')
    )
    op.create_index('ix_ai_usage_tenant_date', 'ai_usage', ['tenant_id', 'usage_date'], unique=False)
    op.create_table('brands',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('name', sa.String(length=100), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_brands_name'), 'brands', ['name'], unique=True)
    op.create_table('categories',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('name', sa.String(length=100), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_categories_name'), 'categories', ['name'], unique=True)
    op.create_table('email_template',
    sa.Column('id', sa.String(length=36), nullable=False),
    sa.Column('name', sa.String(length=100), nullable=False),
    sa.Column('language_code', sa.String(length=5), nullable=False),
    sa.Column('subject_template', sa.String(length=500), nullable=False),
    sa.Column('html_template', sa.Text(), nullable=False),
    sa.Column('text_template', sa.Text(), nullable=False),
    sa.Column('variables_schema', sa.JSON(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=True),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_email_template_language_code'), 'email_template', ['language_code'], unique=False)
    op.create_index(op.f('ix_email_template_name'), 'email_template', ['name'], unique=False)
    op.create_index('ix_email_template_name_lang', 'email_template', ['name', 'language_code'], unique=True)
    op.create_table('idempotency_keys',
    sa.Column('id', sa.String(length=36), nullable=False),
    sa.Column('idempotency_key', sa.String(length=128), nullable=False),
    sa.Column('endpoint', sa.String(length=256), nullable=False),
    sa.Column('user_id', sa.String(length=128), nullable=True),
    sa.Column('request_hash', sa.String(length=64), nullable=True),
    sa.Column('processing', sa.Boolean(), nullable=False),
    sa.Column('status_code', sa.Integer(), nullable=True),
    sa.Column('response_json', sa.Text(), nullable=True),
    sa.Column('headers_json', sa.Text(), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=False),
    sa.Column('updated_at', sa.DateTime(), nullable=False),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('idempotency_key', 'endpoint', 'user_id', 'request_hash', name='uix_idempotency_full_context')
    )
    op.create_table('integration_configs',
    sa.Column('id', sa.String(length=50), nullable=False),
    sa.Column('integration_type', sa.String(length=50), nullable=False),
    sa.Column('config_key', sa.String(length=100), nullable=False),
    sa.Column('config_value', sa.Text(), nullable=True),
    sa.Column('tenant_id', sa.String(length=50), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=True),
    sa.Column('description', sa.String(length=255), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=True),
    sa.Column('updated_at', sa.DateTime(), nullable=True),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('notification_templates',
    sa.Column('id', sa.String(length=50), nullable=False),
    sa.Column('name', sa.String(length=100), nullable=False),
    sa.Column('description', sa.String(length=255), nullable=True),
    sa.Column('title_template', sa.String(length=200), nullable=True),
    sa.Column('body_template', sa.Text(), nullable=True),
    sa.Column('channel', sa.String(length=20), nullable=True),
    sa.Column('variables', sa.String(length=255), nullable=True),
    sa.Column('email_from_name', sa.String(length=100), nullable=True),
    sa.Column('email_from_address', sa.String(length=255), nullable=True),
    sa.Column('email_to_type', sa.String(length=20), nullable=True),
    sa.Column('email_to_addresses', sa.Text(), nullable=True),
    sa.Column('email_subject', sa.String(length=500), nullable=True),
    sa.Column('email_body_html', sa.Text(), nullable=True),
    sa.Column('email_body_text', sa.Text(), nullable=True),
    sa.Column('trigger_event', sa.String(length=100), nullable=True),
    sa.Column('trigger_conditions', sa.Text(), nullable=True),
    sa.Column('template_category', sa.String(length=50), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=True),
    sa.Column('updated_at', sa.DateTime(), nullable=True),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('name')
    )
    op.create_table('permissions',
    sa.Column('id', sa.String(length=50), nullable=False),
    sa.Column('name', sa.String(length=150), nullable=False),
    sa.Column('description', sa.Text(), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=True),
    sa.Column('updated_at', sa.DateTime(), nullable=True),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('name')
    )
    op.create_table('plans',
    sa.Column('id', sa.String(length=36), nullable=False),
    sa.Column('name', sa.String(length=255), nullable=False),
    sa.Column('slug', sa.String(length=100), nullable=False),
    sa.Column('description', sa.Text(), nullable=True),
    sa.Column('plan_type', sa.Enum('BASIC', 'PRO', 'ENTERPRISE', 'CUSTOM', name='plantype'), nullable=False),
    sa.Column('price', sa.Numeric(precision=10, scale=2), nullable=False),
    sa.Column('billing_interval', sa.Enum('MONTHLY', 'YEARLY', 'QUARTERLY', name='billinginterval'), nullable=False),
    sa.Column('features', sa.JSON(), nullable=True),
    sa.Column('max_users', sa.Integer(), nullable=True),
    sa.Column('max_storage_gb', sa.Integer(), nullable=True),
    sa.Column('retention_days', sa.Integer(), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('is_public', sa.Boolean(), nullable=False),
    sa.Column('created_at', sa.DateTime(), nullable=False),
    sa.Column('updated_at', sa.DateTime(), nullable=False),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('idx_plans_is_active', 'plans', ['is_active'], unique=False)
    op.create_index('idx_plans_is_public', 'plans', ['is_public'], unique=False)
    op.create_index('idx_plans_name', 'plans', ['name'], unique=False)
    op.create_index('idx_plans_plan_type', 'plans', ['plan_type'], unique=False)
    op.create_index('idx_plans_slug', 'plans', ['slug'], unique=False)
    op.create_index(op.f('ix_plans_is_active'), 'plans', ['is_active'], unique=False)
    op.create_index(op.f('ix_plans_name'), 'plans', ['name'], unique=False)
    op.create_index(op.f('ix_plans_plan_type'), 'plans', ['plan_type'], unique=False)
    op.create_index(op.f('ix_plans_slug'), 'plans', ['slug'], unique=True)
    op.create_table('production_orders',
    sa.Column('id', sa.String(length=50), nullable=False),
    sa.Column('tenant_id', sa.String(length=50), nullable=False),
    sa.Column('party_id', sa.String(length=50), nullable=False),
    sa.Column('order_number', sa.String(length=50), nullable=False),
    sa.Column('product_type', sa.String(length=50), nullable=True),
    sa.Column('status', sa.String(length=20), nullable=True),
    sa.Column('manufacturer', sa.String(length=100), nullable=True),
    sa.Column('estimated_delivery_date', sa.DateTime(), nullable=True),
    sa.Column('notes', sa.Text(), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=True),
    sa.Column('updated_at', sa.DateTime(), nullable=True),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('order_number')
    )
    op.create_table('replacements',
    sa.Column('id', sa.String(), nullable=False),
    sa.Column('tenant_id', sa.String(), nullable=True),
    sa.Column('party_id', sa.String(), nullable=False),
    sa.Column('sale_id', sa.String(), nullable=True),
    sa.Column('old_device_id', sa.String(), nullable=True),
    sa.Column('new_device_id', sa.String(), nullable=True),
    sa.Column('old_device_info', sa.JSON(), nullable=True),
    sa.Column('new_device_info', sa.JSON(), nullable=True),
    sa.Column('replacement_reason', sa.String(), nullable=True),
    sa.Column('status', sa.String(), nullable=False),
    sa.Column('price_difference', sa.Numeric(), nullable=True),
    sa.Column('return_invoice_id', sa.String(), nullable=True),
    sa.Column('return_invoice_status', sa.String(), nullable=True),
    sa.Column('gib_sent', sa.Boolean(), nullable=True),
    sa.Column('gib_sent_date', sa.DateTime(), nullable=True),
    sa.Column('created_by', sa.String(), nullable=True),
    sa.Column('notes', sa.Text(), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=True),
    sa.Column('updated_at', sa.DateTime(), nullable=True),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_replacements_party_id'), 'replacements', ['party_id'], unique=False)
    op.create_index(op.f('ix_replacements_return_invoice_id'), 'replacements', ['return_invoice_id'], unique=False)
    op.create_index(op.f('ix_replacements_sale_id'), 'replacements', ['sale_id'], unique=False)
    op.create_index(op.f('ix_replacements_status'), 'replacements', ['status'], unique=False)
    op.create_index(op.f('ix_replacements_tenant_id'), 'replacements', ['tenant_id'], unique=False)
    op.create_table('roles',
    sa.Column('id', sa.String(length=50), nullable=False),
    sa.Column('name', sa.String(length=100), nullable=False),
    sa.Column('description', sa.Text(), nullable=True),
    sa.Column('is_system', sa.Boolean(), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=True),
    sa.Column('updated_at', sa.DateTime(), nullable=True),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('name')
    )
    op.create_table('scan_queue',
    sa.Column('id', sa.String(length=50), nullable=False),
    sa.Column('tenant_id', sa.String(length=50), nullable=False),
    sa.Column('party_id', sa.String(length=50), nullable=False),
    sa.Column('status', sa.String(length=20), nullable=True),
    sa.Column('priority', sa.String(length=10), nullable=True),
    sa.Column('file_path', sa.String(length=255), nullable=True),
    sa.Column('model_path', sa.String(length=255), nullable=True),
    sa.Column('polygon_count', sa.Integer(), nullable=True),
    sa.Column('render_time_ms', sa.Integer(), nullable=True),
    sa.Column('error_message', sa.Text(), nullable=True),
    sa.Column('started_at', sa.DateTime(), nullable=True),
    sa.Column('completed_at', sa.DateTime(), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=True),
    sa.Column('updated_at', sa.DateTime(), nullable=True),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('settings',
    sa.Column('id', sa.String(length=50), nullable=False),
    sa.Column('settings_data', sa.Text(), nullable=False),
    sa.Column('created_at', sa.DateTime(), nullable=True),
    sa.Column('updated_at', sa.DateTime(), nullable=True),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('sms_packages',
    sa.Column('id', sa.String(length=36), nullable=False),
    sa.Column('name', sa.String(length=100), nullable=False),
    sa.Column('description', sa.String(length=500), nullable=True),
    sa.Column('sms_count', sa.Integer(), nullable=False),
    sa.Column('price', sa.Float(), nullable=False),
    sa.Column('currency', sa.String(length=3), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=True),
    sa.Column('updated_at', sa.DateTime(), nullable=True),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('system_settings',
    sa.Column('key', sa.String(length=100), nullable=False),
    sa.Column('value', sa.Text(), nullable=True),
    sa.Column('description', sa.String(length=255), nullable=True),
    sa.Column('category', sa.String(length=50), nullable=True),
    sa.Column('is_public', sa.Boolean(), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=True),
    sa.Column('updated_at', sa.DateTime(), nullable=True),
    sa.PrimaryKeyConstraint('key')
    )
    op.create_table('admin_role_permissions',
    sa.Column('id', sa.String(length=36), nullable=False),
    sa.Column('role_id', sa.String(length=36), nullable=False),
    sa.Column('permission_id', sa.String(length=36), nullable=False),
    sa.Column('created_at', sa.DateTime(), nullable=True),
    sa.ForeignKeyConstraint(['permission_id'], ['admin_permissions.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['role_id'], ['admin_roles.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('role_id', 'permission_id', name='uq_admin_role_permission')
    )
    op.create_table('admin_user_roles',
    sa.Column('id', sa.String(length=36), nullable=False),
    sa.Column('admin_user_id', sa.String(length=36), nullable=False),
    sa.Column('role_id', sa.String(length=36), nullable=False),
    sa.Column('created_at', sa.DateTime(), nullable=True),
    sa.ForeignKeyConstraint(['admin_user_id'], ['admin_users.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['role_id'], ['admin_roles.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('admin_user_id', 'role_id', name='uq_admin_user_role')
    )
    op.create_table('ai_actions',
    sa.Column('id', sa.String(length=64), nullable=False),
    sa.Column('request_id', sa.String(length=64), nullable=False),
    sa.Column('tenant_id', sa.String(length=64), nullable=False),
    sa.Column('user_id', sa.String(length=64), nullable=False),
    sa.Column('action_plan', sa.JSON(), nullable=False),
    sa.Column('action_plan_hash', sa.String(length=64), nullable=False),
    sa.Column('tool_schema_versions', sa.JSON(), nullable=False),
    sa.Column('risk_level', sa.String(length=16), nullable=False),
    sa.Column('risk_reasoning', sa.Text(), nullable=True),
    sa.Column('required_permissions', sa.JSON(), nullable=True),
    sa.Column('rollback_plan', sa.JSON(), nullable=True),
    sa.Column('status', sa.String(length=20), nullable=False),
    sa.Column('approval_token_hash', sa.String(length=64), nullable=True),
    sa.Column('approval_expires_at', sa.DateTime(), nullable=True),
    sa.Column('approved_by', sa.String(length=64), nullable=True),
    sa.Column('approved_at', sa.DateTime(), nullable=True),
    sa.Column('rejection_reason', sa.Text(), nullable=True),
    sa.Column('execution_started_at', sa.DateTime(), nullable=True),
    sa.Column('execution_completed_at', sa.DateTime(), nullable=True),
    sa.Column('execution_result', sa.JSON(), nullable=True),
    sa.Column('execution_error', sa.Text(), nullable=True),
    sa.Column('dry_run_result', sa.JSON(), nullable=True),
    sa.Column('idempotency_key', sa.String(length=128), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=False),
    sa.Column('updated_at', sa.DateTime(), nullable=False),
    sa.ForeignKeyConstraint(['request_id'], ['ai_requests.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_ai_actions_action_plan_hash'), 'ai_actions', ['action_plan_hash'], unique=False)
    op.create_index('ix_ai_actions_approval_pending', 'ai_actions', ['status', 'approval_expires_at'], unique=False)
    op.create_index(op.f('ix_ai_actions_idempotency_key'), 'ai_actions', ['idempotency_key'], unique=False)
    op.create_index(op.f('ix_ai_actions_request_id'), 'ai_actions', ['request_id'], unique=False)
    op.create_index('ix_ai_actions_tenant_created', 'ai_actions', ['tenant_id', 'created_at'], unique=False)
    op.create_index(op.f('ix_ai_actions_tenant_id'), 'ai_actions', ['tenant_id'], unique=False)
    op.create_index('ix_ai_actions_tenant_status', 'ai_actions', ['tenant_id', 'status'], unique=False)
    op.create_index(op.f('ix_ai_actions_user_id'), 'ai_actions', ['user_id'], unique=False)
    op.create_table('commission_ledger',
    sa.Column('id', sa.Integer(), autoincrement=True, nullable=False),
    sa.Column('affiliate_id', sa.Integer(), nullable=False),
    sa.Column('tenant_id', sa.Integer(), nullable=False),
    sa.Column('event', sa.String(length=64), nullable=False),
    sa.Column('amount', sa.Numeric(precision=12, scale=2), nullable=False),
    sa.Column('status', sa.String(length=32), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=False),
    sa.ForeignKeyConstraint(['affiliate_id'], ['affiliate_user.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_commission_ledger_affiliate_id'), 'commission_ledger', ['affiliate_id'], unique=False)
    op.create_index(op.f('ix_commission_ledger_tenant_id'), 'commission_ledger', ['tenant_id'], unique=False)
    op.create_table('role_permissions',
    sa.Column('role_id', sa.String(length=50), nullable=False),
    sa.Column('permission_id', sa.String(length=50), nullable=False),
    sa.ForeignKeyConstraint(['permission_id'], ['permissions.id'], ),
    sa.ForeignKeyConstraint(['role_id'], ['roles.id'], ),
    sa.PrimaryKeyConstraint('role_id', 'permission_id')
    )
    op.create_table('tenants',
    sa.Column('id', sa.String(length=36), nullable=False),
    sa.Column('name', sa.String(length=255), nullable=False),
    sa.Column('slug', sa.String(length=100), nullable=False),
    sa.Column('description', sa.Text(), nullable=True),
    sa.Column('owner_email', sa.String(length=255), nullable=False),
    sa.Column('billing_email', sa.String(length=255), nullable=False),
    sa.Column('affiliate_id', sa.Integer(), nullable=True),
    sa.Column('referral_code', sa.String(length=50), nullable=True),
    sa.Column('product_code', sa.String(length=50), nullable=True),
    sa.Column('tenant_type', sa.String(length=20), server_default='B2B', nullable=False),
    sa.Column('status', sa.String(length=20), nullable=False),
    sa.Column('current_plan', sa.String(length=50), nullable=True),
    sa.Column('current_plan_id', sa.String(length=36), nullable=True),
    sa.Column('subscription_start_date', sa.DateTime(), nullable=True),
    sa.Column('subscription_end_date', sa.DateTime(), nullable=True),
    sa.Column('feature_usage', sa.JSON(), nullable=True),
    sa.Column('max_users', sa.Integer(), nullable=True),
    sa.Column('current_users', sa.Integer(), nullable=True),
    sa.Column('max_branches', sa.Integer(), nullable=True),
    sa.Column('current_branches', sa.Integer(), nullable=True),
    sa.Column('company_info', sa.JSON(), nullable=True),
    sa.Column('settings', sa.JSON(), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=False),
    sa.Column('updated_at', sa.DateTime(), nullable=False),
    sa.Column('deleted_at', sa.DateTime(), nullable=True),
    sa.ForeignKeyConstraint(['affiliate_id'], ['affiliate_user.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('idx_tenants_slug', 'tenants', ['slug'], unique=False)
    op.create_index('idx_tenants_status', 'tenants', ['status'], unique=False)
    op.create_index(op.f('ix_tenants_affiliate_id'), 'tenants', ['affiliate_id'], unique=False)
    op.create_index(op.f('ix_tenants_name'), 'tenants', ['name'], unique=False)
    op.create_index(op.f('ix_tenants_product_code'), 'tenants', ['product_code'], unique=False)
    op.create_index(op.f('ix_tenants_slug'), 'tenants', ['slug'], unique=True)
    op.create_index(op.f('ix_tenants_status'), 'tenants', ['status'], unique=False)
    op.create_index(op.f('ix_tenants_tenant_type'), 'tenants', ['tenant_type'], unique=False)
    op.create_table('branches',
    sa.Column('id', sa.String(length=50), nullable=False),
    sa.Column('tenant_id', sa.String(length=36), nullable=False),
    sa.Column('name', sa.String(length=100), nullable=False),
    sa.Column('address', sa.String(length=255), nullable=True),
    sa.Column('phone', sa.String(length=20), nullable=True),
    sa.Column('email', sa.String(length=100), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=True),
    sa.Column('updated_at', sa.DateTime(), nullable=True),
    sa.ForeignKeyConstraint(['tenant_id'], ['tenants.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_branches_tenant_id'), 'branches', ['tenant_id'], unique=False)
    op.create_table('campaigns',
    sa.Column('id', sa.String(length=50), nullable=False),
    sa.Column('name', sa.String(length=200), nullable=False),
    sa.Column('description', sa.Text(), nullable=True),
    sa.Column('campaign_type', sa.String(length=50), nullable=True),
    sa.Column('tenant_id', sa.String(length=36), nullable=False),
    sa.Column('target_segment', sa.String(length=50), nullable=True),
    sa.Column('target_criteria', sa.Text(), nullable=True),
    sa.Column('message_template', sa.Text(), nullable=False),
    sa.Column('subject', sa.String(length=200), nullable=True),
    sa.Column('scheduled_at', sa.DateTime(), nullable=True),
    sa.Column('sent_at', sa.DateTime(), nullable=True),
    sa.Column('status', sa.String(length=20), nullable=True),
    sa.Column('total_recipients', sa.Integer(), nullable=True),
    sa.Column('successful_sends', sa.Integer(), nullable=True),
    sa.Column('failed_sends', sa.Integer(), nullable=True),
    sa.Column('estimated_cost', sa.Float(), nullable=True),
    sa.Column('actual_cost', sa.Float(), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=True),
    sa.Column('updated_at', sa.DateTime(), nullable=True),
    sa.ForeignKeyConstraint(['tenant_id'], ['tenants.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_campaigns_tenant_id'), 'campaigns', ['tenant_id'], unique=False)
    op.create_table('communication_templates',
    sa.Column('id', sa.String(length=50), nullable=False),
    sa.Column('name', sa.String(length=200), nullable=False),
    sa.Column('description', sa.Text(), nullable=True),
    sa.Column('template_type', sa.String(length=20), nullable=False),
    sa.Column('category', sa.String(length=50), nullable=True),
    sa.Column('tenant_id', sa.String(length=36), nullable=False),
    sa.Column('subject', sa.String(length=500), nullable=True),
    sa.Column('body_text', sa.Text(), nullable=False),
    sa.Column('body_html', sa.Text(), nullable=True),
    sa.Column('variables', sa.Text(), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=True),
    sa.Column('is_system', sa.Boolean(), nullable=True),
    sa.Column('usage_count', sa.Integer(), nullable=True),
    sa.Column('last_used_at', sa.DateTime(), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=True),
    sa.Column('updated_at', sa.DateTime(), nullable=True),
    sa.ForeignKeyConstraint(['tenant_id'], ['tenants.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_communication_templates_tenant_id'), 'communication_templates', ['tenant_id'], unique=False)
    op.create_index('ix_template_active', 'communication_templates', ['is_active'], unique=False)
    op.create_index('ix_template_category', 'communication_templates', ['category'], unique=False)
    op.create_index('ix_template_system', 'communication_templates', ['is_system'], unique=False)
    op.create_index('ix_template_type', 'communication_templates', ['template_type'], unique=False)
    op.create_table('efatura_outbox',
    sa.Column('id', sa.Integer(), autoincrement=True, nullable=False),
    sa.Column('invoice_id', sa.String(), nullable=True),
    sa.Column('replacement_id', sa.String(), nullable=True),
    sa.Column('tenant_id', sa.String(length=36), nullable=False),
    sa.Column('file_name', sa.String(), nullable=True),
    sa.Column('ettn', sa.String(), nullable=True),
    sa.Column('uuid', sa.String(), nullable=True),
    sa.Column('xml_content', sa.Text(), nullable=True),
    sa.Column('status', sa.String(), nullable=False),
    sa.Column('created_at', sa.DateTime(), nullable=True),
    sa.Column('updated_at', sa.DateTime(), nullable=True),
    sa.ForeignKeyConstraint(['tenant_id'], ['tenants.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_efatura_outbox_invoice_id'), 'efatura_outbox', ['invoice_id'], unique=False)
    op.create_index(op.f('ix_efatura_outbox_replacement_id'), 'efatura_outbox', ['replacement_id'], unique=False)
    op.create_index(op.f('ix_efatura_outbox_tenant_id'), 'efatura_outbox', ['tenant_id'], unique=False)
    op.create_table('hearing_profiles',
    sa.Column('id', sa.String(length=50), nullable=False),
    sa.Column('party_id', sa.String(length=50), nullable=False),
    sa.Column('sgk_info', sa.Text(), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=True),
    sa.Column('updated_at', sa.DateTime(), nullable=True),
    sa.Column('tenant_id', sa.String(length=36), nullable=True),
    sa.ForeignKeyConstraint(['tenant_id'], ['tenants.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_hearing_profiles_party_id'), 'hearing_profiles', ['party_id'], unique=True)
    op.create_index(op.f('ix_hearing_profiles_tenant_id'), 'hearing_profiles', ['tenant_id'], unique=False)
    op.create_table('marketplace_integrations',
    sa.Column('id', sa.String(length=50), nullable=False),
    sa.Column('tenant_id', sa.String(length=36), nullable=False),
    sa.Column('platform', sa.String(length=50), nullable=False),
    sa.Column('name', sa.String(length=100), nullable=True),
    sa.Column('api_key', sa.String(length=255), nullable=True),
    sa.Column('api_secret', sa.String(length=255), nullable=True),
    sa.Column('seller_id', sa.String(length=100), nullable=True),
    sa.Column('other_params', sa.Text(), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=True),
    sa.Column('sync_stock', sa.Boolean(), nullable=True),
    sa.Column('sync_prices', sa.Boolean(), nullable=True),
    sa.Column('sync_orders', sa.Boolean(), nullable=True),
    sa.Column('last_sync_at', sa.DateTime(), nullable=True),
    sa.Column('status', sa.String(length=20), nullable=True),
    sa.Column('error_message', sa.Text(), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=True),
    sa.Column('updated_at', sa.DateTime(), nullable=True),
    sa.ForeignKeyConstraint(['tenant_id'], ['tenants.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_marketplace_integrations_tenant_id'), 'marketplace_integrations', ['tenant_id'], unique=False)
    op.create_table('notifications',
    sa.Column('id', sa.String(length=50), nullable=False),
    sa.Column('user_id', sa.String(length=50), nullable=False),
    sa.Column('tenant_id', sa.String(length=36), nullable=False),
    sa.Column('title', sa.String(length=200), nullable=False),
    sa.Column('message', sa.Text(), nullable=False),
    sa.Column('notification_type', sa.String(length=50), nullable=True),
    sa.Column('is_read', sa.Boolean(), nullable=True),
    sa.Column('read_at', sa.DateTime(), nullable=True),
    sa.Column('action_url', sa.String(length=500), nullable=True),
    sa.Column('action_label', sa.String(length=100), nullable=True),
    sa.Column('priority', sa.String(length=20), nullable=True),
    sa.Column('expires_at', sa.DateTime(), nullable=True),
    sa.Column('extra_data', sa.Text(), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=True),
    sa.Column('updated_at', sa.DateTime(), nullable=True),
    sa.ForeignKeyConstraint(['tenant_id'], ['tenants.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_notification_priority', 'notifications', ['priority'], unique=False)
    op.create_index('ix_notification_read', 'notifications', ['is_read'], unique=False)
    op.create_index('ix_notification_type', 'notifications', ['notification_type'], unique=False)
    op.create_index('ix_notification_user', 'notifications', ['user_id'], unique=False)
    op.create_index(op.f('ix_notifications_tenant_id'), 'notifications', ['tenant_id'], unique=False)
    op.create_table('ocr_jobs',
    sa.Column('id', sa.String(length=36), nullable=False),
    sa.Column('tenant_id', sa.String(length=36), nullable=False),
    sa.Column('status', sa.Enum('PENDING', 'PROCESSING', 'COMPLETED', 'FAILED', name='ocrjobstatus'), nullable=True),
    sa.Column('file_path', sa.String(length=512), nullable=False),
    sa.Column('result', sa.JSON(), nullable=True),
    sa.Column('error_message', sa.Text(), nullable=True),
    sa.Column('document_type', sa.String(length=50), nullable=True),
    sa.Column('patient_name', sa.String(length=100), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=True),
    sa.Column('updated_at', sa.DateTime(), nullable=True),
    sa.ForeignKeyConstraint(['tenant_id'], ['tenants.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('sms_header_requests',
    sa.Column('id', sa.String(length=50), nullable=False),
    sa.Column('tenant_id', sa.String(length=36), nullable=False),
    sa.Column('header_text', sa.String(length=11), nullable=False),
    sa.Column('header_type', sa.String(length=20), nullable=False),
    sa.Column('status', sa.String(length=20), nullable=True),
    sa.Column('rejection_reason', sa.String(length=500), nullable=True),
    sa.Column('is_default', sa.Boolean(), nullable=True),
    sa.Column('documents', sa.Text(), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=True),
    sa.Column('updated_at', sa.DateTime(), nullable=True),
    sa.ForeignKeyConstraint(['tenant_id'], ['tenants.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_sms_header_requests_tenant_id'), 'sms_header_requests', ['tenant_id'], unique=False)
    op.create_table('sms_provider_configs',
    sa.Column('id', sa.String(length=50), nullable=False),
    sa.Column('tenant_id', sa.String(length=36), nullable=False),
    sa.Column('api_username', sa.String(length=100), nullable=True),
    sa.Column('api_password', sa.String(length=100), nullable=True),
    sa.Column('documents_email', sa.String(length=200), nullable=True),
    sa.Column('documents', sa.Text(), nullable=True),
    sa.Column('documents_submitted', sa.Boolean(), nullable=True),
    sa.Column('documents_submitted_at', sa.DateTime(), nullable=True),
    sa.Column('all_documents_approved', sa.Boolean(), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=True),
    sa.Column('updated_at', sa.DateTime(), nullable=True),
    sa.ForeignKeyConstraint(['tenant_id'], ['tenants.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_sms_provider_configs_tenant_id'), 'sms_provider_configs', ['tenant_id'], unique=True)
    op.create_table('smtp_email_log',
    sa.Column('id', sa.String(length=36), nullable=False),
    sa.Column('tenant_id', sa.String(length=36), nullable=False),
    sa.Column('recipient', sa.String(length=255), nullable=False),
    sa.Column('subject', sa.String(length=500), nullable=False),
    sa.Column('body_preview', sa.Text(), nullable=True),
    sa.Column('status', sa.String(length=20), nullable=False),
    sa.Column('sent_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('error_message', sa.Text(), nullable=True),
    sa.Column('retry_count', sa.Integer(), nullable=True),
    sa.Column('template_name', sa.String(length=100), nullable=True),
    sa.Column('scenario', sa.String(length=100), nullable=True),
    sa.Column('idempotency_key', sa.String(length=128), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=True),
    sa.ForeignKeyConstraint(['tenant_id'], ['tenants.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_smtp_email_log_idempotency_key'), 'smtp_email_log', ['idempotency_key'], unique=False)
    op.create_index(op.f('ix_smtp_email_log_recipient'), 'smtp_email_log', ['recipient'], unique=False)
    op.create_index(op.f('ix_smtp_email_log_sent_at'), 'smtp_email_log', ['sent_at'], unique=False)
    op.create_index(op.f('ix_smtp_email_log_status'), 'smtp_email_log', ['status'], unique=False)
    op.create_index(op.f('ix_smtp_email_log_tenant_id'), 'smtp_email_log', ['tenant_id'], unique=False)
    op.create_index('ix_smtp_email_log_tenant_idempotency', 'smtp_email_log', ['tenant_id', 'idempotency_key'], unique=False)
    op.create_index('ix_smtp_email_log_tenant_status_sent', 'smtp_email_log', ['tenant_id', 'status', 'sent_at'], unique=False)
    op.create_table('subscriptions',
    sa.Column('id', sa.String(length=36), nullable=False),
    sa.Column('tenant_id', sa.String(length=36), nullable=False),
    sa.Column('plan_id', sa.String(length=36), nullable=False),
    sa.Column('provider_subscription_id', sa.String(length=100), nullable=True),
    sa.Column('status', sa.String(length=20), nullable=False),
    sa.Column('current_period_start', sa.DateTime(), nullable=False),
    sa.Column('current_period_end', sa.DateTime(), nullable=False),
    sa.Column('cancel_at_period_end', sa.Boolean(), nullable=True),
    sa.Column('canceled_at', sa.DateTime(), nullable=True),
    sa.Column('ocr_requests_count', sa.Integer(), nullable=True),
    sa.Column('trial_start', sa.DateTime(), nullable=True),
    sa.Column('trial_end', sa.DateTime(), nullable=True),
    sa.Column('metadata', sa.JSON(), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=True),
    sa.Column('updated_at', sa.DateTime(), nullable=True),
    sa.ForeignKeyConstraint(['plan_id'], ['plans.id'], ),
    sa.ForeignKeyConstraint(['tenant_id'], ['tenants.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_subscriptions_provider_subscription_id'), 'subscriptions', ['provider_subscription_id'], unique=False)
    op.create_index(op.f('ix_subscriptions_tenant_id'), 'subscriptions', ['tenant_id'], unique=False)
    op.create_table('suppliers',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('tenant_id', sa.String(length=36), nullable=False),
    sa.Column('company_name', sa.String(length=200), nullable=False),
    sa.Column('company_code', sa.String(length=50), nullable=True),
    sa.Column('tax_number', sa.String(length=50), nullable=True),
    sa.Column('tax_office', sa.String(length=100), nullable=True),
    sa.Column('contact_person', sa.String(length=100), nullable=True),
    sa.Column('email', sa.String(length=120), nullable=True),
    sa.Column('phone', sa.String(length=20), nullable=True),
    sa.Column('mobile', sa.String(length=20), nullable=True),
    sa.Column('fax', sa.String(length=20), nullable=True),
    sa.Column('website', sa.String(length=200), nullable=True),
    sa.Column('address', sa.Text(), nullable=True),
    sa.Column('city', sa.String(length=100), nullable=True),
    sa.Column('country', sa.String(length=100), nullable=True),
    sa.Column('postal_code', sa.String(length=20), nullable=True),
    sa.Column('payment_terms', sa.String(length=100), nullable=True),
    sa.Column('currency', sa.String(length=10), nullable=True),
    sa.Column('rating', sa.Integer(), nullable=True),
    sa.Column('notes', sa.Text(), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=True),
    sa.Column('updated_at', sa.DateTime(), nullable=True),
    sa.ForeignKeyConstraint(['tenant_id'], ['tenants.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_suppliers_company_code'), 'suppliers', ['company_code'], unique=True)
    op.create_index(op.f('ix_suppliers_company_name'), 'suppliers', ['company_name'], unique=True)
    op.create_index(op.f('ix_suppliers_email'), 'suppliers', ['email'], unique=False)
    op.create_index(op.f('ix_suppliers_is_active'), 'suppliers', ['is_active'], unique=False)
    op.create_index(op.f('ix_suppliers_tenant_id'), 'suppliers', ['tenant_id'], unique=False)
    op.create_table('target_audiences',
    sa.Column('id', sa.String(length=50), nullable=False),
    sa.Column('tenant_id', sa.String(length=36), nullable=False),
    sa.Column('name', sa.String(length=100), nullable=False),
    sa.Column('source_type', sa.String(length=20), nullable=True),
    sa.Column('file_path', sa.String(length=500), nullable=True),
    sa.Column('total_records', sa.Integer(), nullable=True),
    sa.Column('filter_criteria', sa.Text(), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=True),
    sa.Column('updated_at', sa.DateTime(), nullable=True),
    sa.ForeignKeyConstraint(['tenant_id'], ['tenants.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_target_audiences_tenant_id'), 'target_audiences', ['tenant_id'], unique=False)
    op.create_table('tenant_sms_credits',
    sa.Column('id', sa.String(length=50), nullable=False),
    sa.Column('tenant_id', sa.String(length=36), nullable=False),
    sa.Column('balance', sa.Integer(), nullable=True),
    sa.Column('total_purchased', sa.Integer(), nullable=True),
    sa.Column('total_used', sa.Integer(), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=True),
    sa.Column('updated_at', sa.DateTime(), nullable=True),
    sa.ForeignKeyConstraint(['tenant_id'], ['tenants.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_tenant_sms_credits_tenant_id'), 'tenant_sms_credits', ['tenant_id'], unique=True)
    op.create_table('tenant_smtp_config',
    sa.Column('id', sa.String(length=36), nullable=False),
    sa.Column('tenant_id', sa.String(length=36), nullable=False),
    sa.Column('host', sa.String(length=255), nullable=False),
    sa.Column('port', sa.Integer(), nullable=False),
    sa.Column('username', sa.String(length=255), nullable=False),
    sa.Column('encrypted_password', sa.Text(), nullable=False),
    sa.Column('from_email', sa.String(length=255), nullable=False),
    sa.Column('from_name', sa.String(length=255), nullable=False),
    sa.Column('use_tls', sa.Boolean(), nullable=True),
    sa.Column('use_ssl', sa.Boolean(), nullable=True),
    sa.Column('timeout', sa.Integer(), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=True),
    sa.ForeignKeyConstraint(['tenant_id'], ['tenants.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_tenant_smtp_config_is_active'), 'tenant_smtp_config', ['is_active'], unique=False)
    op.create_index('ix_tenant_smtp_config_tenant_active', 'tenant_smtp_config', ['tenant_id', 'is_active'], unique=False)
    op.create_index(op.f('ix_tenant_smtp_config_tenant_id'), 'tenant_smtp_config', ['tenant_id'], unique=False)
    op.create_table('users',
    sa.Column('id', sa.String(length=50), nullable=False),
    sa.Column('username', sa.String(length=80), nullable=False),
    sa.Column('email', sa.String(length=120), nullable=False),
    sa.Column('phone', sa.String(length=20), nullable=True),
    sa.Column('tenant_id', sa.String(length=36), nullable=False),
    sa.Column('password_hash', sa.String(length=255), nullable=False),
    sa.Column('first_name', sa.String(length=100), nullable=True),
    sa.Column('last_name', sa.String(length=100), nullable=True),
    sa.Column('role', sa.String(length=20), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=True),
    sa.Column('is_phone_verified', sa.Boolean(), nullable=True),
    sa.Column('permissions_version', sa.Integer(), nullable=False),
    sa.Column('last_login', sa.DateTime(), nullable=True),
    sa.Column('password_reset_token', sa.String(length=100), nullable=True),
    sa.Column('password_reset_expires', sa.DateTime(), nullable=True),
    sa.Column('affiliate_code', sa.String(length=50), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=True),
    sa.Column('updated_at', sa.DateTime(), nullable=True),
    sa.ForeignKeyConstraint(['tenant_id'], ['tenants.id'], ),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('email'),
    sa.UniqueConstraint('phone'),
    sa.UniqueConstraint('username')
    )
    op.create_index(op.f('ix_users_affiliate_code'), 'users', ['affiliate_code'], unique=False)
    op.create_index(op.f('ix_users_tenant_id'), 'users', ['tenant_id'], unique=False)
    op.create_table('activity_logs',
    sa.Column('id', sa.String(length=50), nullable=False),
    sa.Column('tenant_id', sa.String(length=36), nullable=True),
    sa.Column('branch_id', sa.String(length=50), nullable=True),
    sa.Column('user_id', sa.String(length=50), nullable=True),
    sa.Column('real_user_id', sa.String(length=50), nullable=True),
    sa.Column('role', sa.String(length=50), nullable=True),
    sa.Column('action', sa.String(length=100), nullable=False),
    sa.Column('message', sa.String(length=500), nullable=True),
    sa.Column('entity_type', sa.String(length=50), nullable=True),
    sa.Column('entity_id', sa.String(length=50), nullable=True),
    sa.Column('data', sa.Text(), nullable=True),
    sa.Column('ip_address', sa.String(length=45), nullable=True),
    sa.Column('user_agent', sa.Text(), nullable=True),
    sa.Column('details', sa.Text(), nullable=True),
    sa.Column('is_critical', sa.Boolean(), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=True),
    sa.Column('updated_at', sa.DateTime(), nullable=True),
    sa.ForeignKeyConstraint(['branch_id'], ['branches.id'], ),
    sa.ForeignKeyConstraint(['tenant_id'], ['tenants.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_activity_action', 'activity_logs', ['action'], unique=False)
    op.create_index('ix_activity_created', 'activity_logs', ['created_at'], unique=False)
    op.create_index('ix_activity_entity', 'activity_logs', ['entity_type', 'entity_id'], unique=False)
    op.create_index(op.f('ix_activity_logs_is_critical'), 'activity_logs', ['is_critical'], unique=False)
    op.create_index(op.f('ix_activity_logs_tenant_id'), 'activity_logs', ['tenant_id'], unique=False)
    op.create_index('ix_activity_tenant_action', 'activity_logs', ['tenant_id', 'action'], unique=False)
    op.create_index('ix_activity_tenant_created', 'activity_logs', ['tenant_id', 'created_at'], unique=False)
    op.create_index('ix_activity_user', 'activity_logs', ['user_id'], unique=False)
    op.create_table('api_keys',
    sa.Column('id', sa.String(length=50), nullable=False),
    sa.Column('name', sa.String(length=100), nullable=False),
    sa.Column('key_prefix', sa.String(length=10), nullable=False),
    sa.Column('key_hash', sa.String(length=255), nullable=False),
    sa.Column('tenant_id', sa.String(length=36), nullable=False),
    sa.Column('created_by', sa.String(length=50), nullable=True),
    sa.Column('scopes', sa.Text(), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=True),
    sa.Column('expires_at', sa.DateTime(), nullable=True),
    sa.Column('last_used_at', sa.DateTime(), nullable=True),
    sa.Column('rate_limit', sa.Integer(), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=True),
    sa.Column('updated_at', sa.DateTime(), nullable=True),
    sa.ForeignKeyConstraint(['created_by'], ['users.id'], ),
    sa.ForeignKeyConstraint(['tenant_id'], ['tenants.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_api_keys_key_hash'), 'api_keys', ['key_hash'], unique=False)
    op.create_index(op.f('ix_api_keys_tenant_id'), 'api_keys', ['tenant_id'], unique=False)
    op.create_table('apps',
    sa.Column('id', sa.String(length=50), nullable=False),
    sa.Column('name', sa.String(length=150), nullable=False),
    sa.Column('slug', sa.String(length=80), nullable=False),
    sa.Column('description', sa.Text(), nullable=True),
    sa.Column('owner_user_id', sa.String(length=50), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=True),
    sa.Column('updated_at', sa.DateTime(), nullable=True),
    sa.ForeignKeyConstraint(['owner_user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('slug')
    )
    op.create_table('inventory',
    sa.Column('id', sa.String(length=50), nullable=False),
    sa.Column('tenant_id', sa.String(length=36), nullable=False),
    sa.Column('branch_id', sa.String(length=50), nullable=True),
    sa.Column('name', sa.String(length=200), nullable=False),
    sa.Column('brand', sa.String(length=100), nullable=False),
    sa.Column('model', sa.String(length=100), nullable=True),
    sa.Column('category', sa.String(length=50), nullable=False),
    sa.Column('barcode', sa.String(length=100), nullable=True),
    sa.Column('stock_code', sa.String(length=100), nullable=True),
    sa.Column('supplier', sa.String(length=200), nullable=True),
    sa.Column('unit', sa.String(length=50), nullable=True),
    sa.Column('description', sa.Text(), nullable=True),
    sa.Column('available_inventory', sa.Integer(), nullable=False),
    sa.Column('total_inventory', sa.Integer(), nullable=False),
    sa.Column('used_inventory', sa.Integer(), nullable=False),
    sa.Column('on_trial', sa.Integer(), nullable=False),
    sa.Column('reorder_level', sa.Integer(), nullable=False),
    sa.Column('available_serials', sa.Text(), nullable=True),
    sa.Column('price', sa.Float(), nullable=False),
    sa.Column('cost', sa.Float(), nullable=True),
    sa.Column('kdv_rate', sa.Float(), nullable=True),
    sa.Column('price_includes_kdv', sa.Boolean(), nullable=True),
    sa.Column('cost_includes_kdv', sa.Boolean(), nullable=True),
    sa.Column('features', sa.Text(), nullable=True),
    sa.Column('direction', sa.String(length=10), nullable=True),
    sa.Column('ear', sa.String(length=10), nullable=True),
    sa.Column('warranty', sa.Integer(), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=True),
    sa.Column('updated_at', sa.DateTime(), nullable=True),
    sa.ForeignKeyConstraint(['branch_id'], ['branches.id'], ),
    sa.ForeignKeyConstraint(['tenant_id'], ['tenants.id'], ),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('barcode'),
    sa.UniqueConstraint('stock_code')
    )
    op.create_index(op.f('ix_inventory_branch_id'), 'inventory', ['branch_id'], unique=False)
    op.create_index(op.f('ix_inventory_tenant_id'), 'inventory', ['tenant_id'], unique=False)
    op.create_table('marketplace_products',
    sa.Column('id', sa.String(length=50), nullable=False),
    sa.Column('integration_id', sa.String(length=50), nullable=False),
    sa.Column('local_product_type', sa.String(length=20), nullable=True),
    sa.Column('local_product_id', sa.String(length=50), nullable=True),
    sa.Column('remote_product_id', sa.String(length=100), nullable=True),
    sa.Column('remote_sku', sa.String(length=100), nullable=True),
    sa.Column('remote_price', sa.Numeric(precision=12, scale=2), nullable=True),
    sa.Column('remote_stock', sa.Integer(), nullable=True),
    sa.Column('is_synced', sa.Boolean(), nullable=True),
    sa.Column('last_sync_at', sa.DateTime(), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=True),
    sa.Column('updated_at', sa.DateTime(), nullable=True),
    sa.ForeignKeyConstraint(['integration_id'], ['marketplace_integrations.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('parties',
    sa.Column('id', sa.String(length=50), nullable=False),
    sa.Column('tc_number', sa.String(length=11), nullable=True),
    sa.Column('identity_number', sa.String(length=20), nullable=True),
    sa.Column('first_name', sa.String(length=100), nullable=False),
    sa.Column('last_name', sa.String(length=100), nullable=False),
    sa.Column('phone', sa.String(length=20), nullable=False),
    sa.Column('email', sa.String(length=120), nullable=True),
    sa.Column('birth_date', sa.DateTime(), nullable=True),
    sa.Column('gender', sa.String(length=1), nullable=True),
    sa.Column('address_city', sa.String(length=100), nullable=True),
    sa.Column('address_district', sa.String(length=100), nullable=True),
    sa.Column('address_full', sa.Text(), nullable=True),
    sa.Column('status', core.models.base.LowercaseEnum(length=20), nullable=True),
    sa.Column('segment', sa.String(length=20), nullable=True),
    sa.Column('acquisition_type', sa.String(length=50), nullable=True),
    sa.Column('conversion_step', sa.String(length=50), nullable=True),
    sa.Column('referred_by', sa.String(length=100), nullable=True),
    sa.Column('priority_score', sa.Integer(), nullable=True),
    sa.Column('branch_id', sa.String(length=50), nullable=True),
    sa.Column('tenant_id', sa.String(length=36), nullable=False),
    sa.Column('tags', sa.Text(), nullable=True),
    sa.Column('sgk_info', sa.Text(), nullable=True),
    sa.Column('custom_data', sa.Text(), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=True),
    sa.Column('updated_at', sa.DateTime(), nullable=True),
    sa.ForeignKeyConstraint(['branch_id'], ['branches.id'], ),
    sa.ForeignKeyConstraint(['tenant_id'], ['tenants.id'], ),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('phone'),
    sa.UniqueConstraint('tc_number')
    )
    op.create_index(op.f('ix_parties_branch_id'), 'parties', ['branch_id'], unique=False)
    op.create_index(op.f('ix_parties_tenant_id'), 'parties', ['tenant_id'], unique=False)
    op.create_table('payment_history',
    sa.Column('id', sa.String(length=36), nullable=False),
    sa.Column('tenant_id', sa.String(length=36), nullable=False),
    sa.Column('subscription_id', sa.String(length=36), nullable=True),
    sa.Column('amount', sa.Numeric(precision=10, scale=2), nullable=False),
    sa.Column('currency', sa.String(length=3), nullable=False),
    sa.Column('status', sa.String(length=20), nullable=False),
    sa.Column('provider_payment_id', sa.String(length=100), nullable=True),
    sa.Column('payment_method', sa.String(length=50), nullable=True),
    sa.Column('description', sa.String(length=255), nullable=True),
    sa.Column('invoice_url', sa.String(length=500), nullable=True),
    sa.Column('paid_at', sa.DateTime(), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=True),
    sa.Column('updated_at', sa.DateTime(), nullable=True),
    sa.ForeignKeyConstraint(['subscription_id'], ['subscriptions.id'], ),
    sa.ForeignKeyConstraint(['tenant_id'], ['tenants.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_payment_history_provider_payment_id'), 'payment_history', ['provider_payment_id'], unique=False)
    op.create_index(op.f('ix_payment_history_tenant_id'), 'payment_history', ['tenant_id'], unique=False)
    op.create_table('purchase_invoices',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('tenant_id', sa.String(length=36), nullable=False),
    sa.Column('branch_id', sa.String(length=50), nullable=True),
    sa.Column('birfatura_uuid', sa.String(length=100), nullable=False),
    sa.Column('invoice_number', sa.String(length=100), nullable=True),
    sa.Column('invoice_date', sa.DateTime(), nullable=False),
    sa.Column('invoice_type', sa.String(length=50), nullable=True),
    sa.Column('sender_name', sa.String(length=200), nullable=False),
    sa.Column('sender_tax_number', sa.String(length=50), nullable=False),
    sa.Column('sender_tax_office', sa.String(length=100), nullable=True),
    sa.Column('sender_address', sa.Text(), nullable=True),
    sa.Column('sender_city', sa.String(length=100), nullable=True),
    sa.Column('supplier_id', sa.Integer(), nullable=True),
    sa.Column('currency', sa.String(length=10), nullable=True),
    sa.Column('subtotal', sa.Numeric(precision=12, scale=2), nullable=True),
    sa.Column('tax_amount', sa.Numeric(precision=12, scale=2), nullable=True),
    sa.Column('total_amount', sa.Numeric(precision=12, scale=2), nullable=False),
    sa.Column('raw_data', sa.JSON(), nullable=True),
    sa.Column('status', sa.String(length=50), nullable=True),
    sa.Column('is_matched', sa.Boolean(), nullable=True),
    sa.Column('notes', sa.Text(), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=True),
    sa.Column('updated_at', sa.DateTime(), nullable=True),
    sa.ForeignKeyConstraint(['branch_id'], ['branches.id'], ),
    sa.ForeignKeyConstraint(['supplier_id'], ['suppliers.id'], ),
    sa.ForeignKeyConstraint(['tenant_id'], ['tenants.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_purchase_invoices_birfatura_uuid'), 'purchase_invoices', ['birfatura_uuid'], unique=True)
    op.create_index(op.f('ix_purchase_invoices_branch_id'), 'purchase_invoices', ['branch_id'], unique=False)
    op.create_index(op.f('ix_purchase_invoices_invoice_date'), 'purchase_invoices', ['invoice_date'], unique=False)
    op.create_index(op.f('ix_purchase_invoices_invoice_number'), 'purchase_invoices', ['invoice_number'], unique=False)
    op.create_index(op.f('ix_purchase_invoices_sender_tax_number'), 'purchase_invoices', ['sender_tax_number'], unique=False)
    op.create_index(op.f('ix_purchase_invoices_supplier_id'), 'purchase_invoices', ['supplier_id'], unique=False)
    op.create_index(op.f('ix_purchase_invoices_tenant_id'), 'purchase_invoices', ['tenant_id'], unique=False)
    op.create_table('suggested_suppliers',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('tenant_id', sa.String(length=36), nullable=False),
    sa.Column('branch_id', sa.String(length=50), nullable=True),
    sa.Column('company_name', sa.String(length=200), nullable=False),
    sa.Column('tax_number', sa.String(length=50), nullable=False),
    sa.Column('tax_office', sa.String(length=100), nullable=True),
    sa.Column('address', sa.Text(), nullable=True),
    sa.Column('city', sa.String(length=100), nullable=True),
    sa.Column('invoice_count', sa.Integer(), nullable=True),
    sa.Column('total_amount', sa.Numeric(precision=12, scale=2), nullable=True),
    sa.Column('first_invoice_date', sa.DateTime(), nullable=True),
    sa.Column('last_invoice_date', sa.DateTime(), nullable=True),
    sa.Column('status', sa.String(length=50), nullable=True),
    sa.Column('accepted_at', sa.DateTime(), nullable=True),
    sa.Column('accepted_by', sa.String(length=100), nullable=True),
    sa.Column('supplier_id', sa.Integer(), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=True),
    sa.Column('updated_at', sa.DateTime(), nullable=True),
    sa.ForeignKeyConstraint(['branch_id'], ['branches.id'], ),
    sa.ForeignKeyConstraint(['supplier_id'], ['suppliers.id'], ),
    sa.ForeignKeyConstraint(['tenant_id'], ['tenants.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_suggested_suppliers_branch_id'), 'suggested_suppliers', ['branch_id'], unique=False)
    op.create_index(op.f('ix_suggested_suppliers_tax_number'), 'suggested_suppliers', ['tax_number'], unique=True)
    op.create_index(op.f('ix_suggested_suppliers_tenant_id'), 'suggested_suppliers', ['tenant_id'], unique=False)
    op.create_table('user_branches',
    sa.Column('user_id', sa.String(length=50), nullable=False),
    sa.Column('branch_id', sa.String(length=50), nullable=False),
    sa.ForeignKeyConstraint(['branch_id'], ['branches.id'], ),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('user_id', 'branch_id')
    )
    op.create_table('appointments',
    sa.Column('id', sa.String(length=50), nullable=False),
    sa.Column('party_id', sa.String(length=50), nullable=False),
    sa.Column('clinician_id', sa.String(length=50), nullable=True),
    sa.Column('branch_id', sa.String(length=50), nullable=True),
    sa.Column('tenant_id', sa.String(length=36), nullable=False),
    sa.Column('date', sa.DateTime(), nullable=False),
    sa.Column('time', sa.String(length=10), nullable=False),
    sa.Column('duration', sa.Integer(), nullable=True),
    sa.Column('appointment_type', sa.String(length=30), nullable=True),
    sa.Column('status', sa.Enum('SCHEDULED', 'CONFIRMED', 'IN_PROGRESS', 'COMPLETED', 'CANCELLED', 'NO_SHOW', 'RESCHEDULED', name='appointmentstatus'), nullable=True),
    sa.Column('notes', sa.Text(), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=True),
    sa.Column('updated_at', sa.DateTime(), nullable=True),
    sa.ForeignKeyConstraint(['party_id'], ['parties.id'], ),
    sa.ForeignKeyConstraint(['tenant_id'], ['tenants.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_appointment_date', 'appointments', ['date'], unique=False)
    op.create_index('ix_appointment_patient', 'appointments', ['party_id'], unique=False)
    op.create_index('ix_appointment_status', 'appointments', ['status'], unique=False)
    op.create_index(op.f('ix_appointments_tenant_id'), 'appointments', ['tenant_id'], unique=False)
    op.create_table('devices',
    sa.Column('id', sa.String(length=50), nullable=False),
    sa.Column('tenant_id', sa.String(length=50), nullable=True),
    sa.Column('party_id', sa.String(length=50), nullable=True),
    sa.Column('inventory_id', sa.String(length=50), nullable=True),
    sa.Column('serial_number', sa.String(length=100), nullable=True),
    sa.Column('serial_number_left', sa.String(length=100), nullable=True),
    sa.Column('serial_number_right', sa.String(length=100), nullable=True),
    sa.Column('brand', sa.String(length=50), nullable=True),
    sa.Column('model', sa.String(length=100), nullable=True),
    sa.Column('device_type', sa.String(length=20), nullable=True),
    sa.Column('category', sa.String(length=50), nullable=True),
    sa.Column('ear', sa.String(length=20), nullable=True),
    sa.Column('status', sa.String(length=20), nullable=True),
    sa.Column('trial_start_date', sa.DateTime(), nullable=True),
    sa.Column('trial_end_date', sa.DateTime(), nullable=True),
    sa.Column('trial_extended_until', sa.DateTime(), nullable=True),
    sa.Column('warranty_start_date', sa.DateTime(), nullable=True),
    sa.Column('warranty_end_date', sa.DateTime(), nullable=True),
    sa.Column('warranty_terms', sa.Text(), nullable=True),
    sa.Column('price', sa.Numeric(precision=12, scale=2), nullable=True),
    sa.Column('notes', sa.Text(), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=True),
    sa.Column('updated_at', sa.DateTime(), nullable=True),
    sa.ForeignKeyConstraint(['party_id'], ['parties.id'], ),
    sa.ForeignKeyConstraint(['tenant_id'], ['tenants.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_device_category', 'devices', ['category'], unique=False)
    op.create_index('ix_device_patient', 'devices', ['party_id'], unique=False)
    op.create_index('ix_device_serial', 'devices', ['serial_number'], unique=False)
    op.create_index('ix_device_serial_left', 'devices', ['serial_number_left'], unique=False)
    op.create_index('ix_device_serial_right', 'devices', ['serial_number_right'], unique=False)
    op.create_index('ix_device_status', 'devices', ['status'], unique=False)
    op.create_table('email_logs',
    sa.Column('id', sa.String(length=50), nullable=False),
    sa.Column('campaign_id', sa.String(length=50), nullable=True),
    sa.Column('party_id', sa.String(length=50), nullable=True),
    sa.Column('template_id', sa.String(length=50), nullable=True),
    sa.Column('tenant_id', sa.String(length=36), nullable=False),
    sa.Column('to_email', sa.String(length=255), nullable=False),
    sa.Column('from_email', sa.String(length=255), nullable=False),
    sa.Column('cc_emails', sa.Text(), nullable=True),
    sa.Column('bcc_emails', sa.Text(), nullable=True),
    sa.Column('subject', sa.String(length=500), nullable=False),
    sa.Column('body_text', sa.Text(), nullable=True),
    sa.Column('body_html', sa.Text(), nullable=True),
    sa.Column('attachments', sa.Text(), nullable=True),
    sa.Column('status', sa.String(length=20), nullable=True),
    sa.Column('provider_response', sa.Text(), nullable=True),
    sa.Column('provider_message_id', sa.String(length=255), nullable=True),
    sa.Column('sent_at', sa.DateTime(), nullable=True),
    sa.Column('delivered_at', sa.DateTime(), nullable=True),
    sa.Column('opened_at', sa.DateTime(), nullable=True),
    sa.Column('clicked_at', sa.DateTime(), nullable=True),
    sa.Column('bounced_at', sa.DateTime(), nullable=True),
    sa.Column('error_message', sa.Text(), nullable=True),
    sa.Column('retry_count', sa.Integer(), nullable=True),
    sa.Column('cost', sa.Float(), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=True),
    sa.Column('updated_at', sa.DateTime(), nullable=True),
    sa.ForeignKeyConstraint(['campaign_id'], ['campaigns.id'], ),
    sa.ForeignKeyConstraint(['party_id'], ['parties.id'], ),
    sa.ForeignKeyConstraint(['template_id'], ['communication_templates.id'], ),
    sa.ForeignKeyConstraint(['tenant_id'], ['tenants.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_email_campaign', 'email_logs', ['campaign_id'], unique=False)
    op.create_index(op.f('ix_email_logs_tenant_id'), 'email_logs', ['tenant_id'], unique=False)
    op.create_index('ix_email_patient', 'email_logs', ['party_id'], unique=False)
    op.create_index('ix_email_sent_at', 'email_logs', ['sent_at'], unique=False)
    op.create_index('ix_email_status', 'email_logs', ['status'], unique=False)
    op.create_index('ix_email_template', 'email_logs', ['template_id'], unique=False)
    op.create_index('ix_email_to_email', 'email_logs', ['to_email'], unique=False)
    op.create_table('ereceipts',
    sa.Column('id', sa.String(length=50), nullable=False),
    sa.Column('party_id', sa.String(length=50), nullable=False),
    sa.Column('tenant_id', sa.String(length=36), nullable=False),
    sa.Column('receipt_number', sa.String(length=50), nullable=False),
    sa.Column('receipt_date', sa.DateTime(), nullable=False),
    sa.Column('doctor_name', sa.String(length=100), nullable=True),
    sa.Column('hospital_name', sa.String(length=200), nullable=True),
    sa.Column('materials', sa.Text(), nullable=True),
    sa.Column('documents', sa.Text(), nullable=True),
    sa.Column('status', sa.String(length=20), nullable=True),
    sa.Column('processed_at', sa.DateTime(), nullable=True),
    sa.Column('notes', sa.Text(), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=True),
    sa.Column('updated_at', sa.DateTime(), nullable=True),
    sa.ForeignKeyConstraint(['party_id'], ['parties.id'], ),
    sa.ForeignKeyConstraint(['tenant_id'], ['tenants.id'], ),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('receipt_number')
    )
    op.create_index(op.f('ix_ereceipts_tenant_id'), 'ereceipts', ['tenant_id'], unique=False)
    op.create_table('hearing_tests',
    sa.Column('id', sa.String(length=50), nullable=False),
    sa.Column('party_id', sa.String(length=50), nullable=False),
    sa.Column('tenant_id', sa.String(length=36), nullable=False),
    sa.Column('test_date', sa.DateTime(), nullable=False),
    sa.Column('test_type', sa.String(length=50), nullable=True),
    sa.Column('conducted_by', sa.String(length=100), nullable=True),
    sa.Column('results', sa.Text(), nullable=True),
    sa.Column('notes', sa.Text(), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=True),
    sa.Column('updated_at', sa.DateTime(), nullable=True),
    sa.ForeignKeyConstraint(['party_id'], ['parties.id'], ),
    sa.ForeignKeyConstraint(['tenant_id'], ['tenants.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_hearing_test_date', 'hearing_tests', ['test_date'], unique=False)
    op.create_index('ix_hearing_test_patient', 'hearing_tests', ['party_id'], unique=False)
    op.create_index(op.f('ix_hearing_tests_tenant_id'), 'hearing_tests', ['tenant_id'], unique=False)
    op.create_table('party_roles',
    sa.Column('id', sa.String(length=50), nullable=False),
    sa.Column('party_id', sa.String(length=50), nullable=False),
    sa.Column('role_code', sa.String(length=20), nullable=False),
    sa.Column('assigned_at', sa.DateTime(), nullable=True),
    sa.Column('tenant_id', sa.String(length=36), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=True),
    sa.Column('updated_at', sa.DateTime(), nullable=True),
    sa.ForeignKeyConstraint(['party_id'], ['parties.id'], ),
    sa.ForeignKeyConstraint(['tenant_id'], ['tenants.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_party_roles_party_id'), 'party_roles', ['party_id'], unique=False)
    op.create_index(op.f('ix_party_roles_tenant_id'), 'party_roles', ['tenant_id'], unique=False)
    op.create_table('patient_notes',
    sa.Column('id', sa.String(length=50), nullable=False),
    sa.Column('party_id', sa.String(length=50), nullable=False),
    sa.Column('author_id', sa.String(length=50), nullable=False),
    sa.Column('appointment_id', sa.String(length=50), nullable=True),
    sa.Column('tenant_id', sa.String(length=36), nullable=False),
    sa.Column('note_type', sa.String(length=20), nullable=True),
    sa.Column('category', sa.String(length=20), nullable=True),
    sa.Column('title', sa.String(length=200), nullable=True),
    sa.Column('content', sa.Text(), nullable=False),
    sa.Column('is_private', sa.Boolean(), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=True),
    sa.Column('updated_at', sa.DateTime(), nullable=True),
    sa.ForeignKeyConstraint(['party_id'], ['parties.id'], ),
    sa.ForeignKeyConstraint(['tenant_id'], ['tenants.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_patient_notes_tenant_id'), 'patient_notes', ['tenant_id'], unique=False)
    op.create_table('product_suppliers',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('product_id', sa.String(length=100), nullable=False),
    sa.Column('supplier_id', sa.Integer(), nullable=False),
    sa.Column('tenant_id', sa.String(length=36), nullable=False),
    sa.Column('supplier_product_code', sa.String(length=100), nullable=True),
    sa.Column('supplier_product_name', sa.String(length=200), nullable=True),
    sa.Column('unit_cost', sa.Numeric(precision=10, scale=2), nullable=True),
    sa.Column('currency', sa.String(length=10), nullable=True),
    sa.Column('minimum_order_quantity', sa.Integer(), nullable=True),
    sa.Column('lead_time_days', sa.Integer(), nullable=True),
    sa.Column('is_primary', sa.Boolean(), nullable=True),
    sa.Column('priority', sa.Integer(), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=True),
    sa.Column('notes', sa.Text(), nullable=True),
    sa.Column('last_order_date', sa.DateTime(), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=True),
    sa.Column('updated_at', sa.DateTime(), nullable=True),
    sa.ForeignKeyConstraint(['product_id'], ['inventory.id'], ),
    sa.ForeignKeyConstraint(['supplier_id'], ['suppliers.id'], ),
    sa.ForeignKeyConstraint(['tenant_id'], ['tenants.id'], ),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('product_id', 'supplier_id', name='unique_product_supplier')
    )
    op.create_index(op.f('ix_product_suppliers_is_active'), 'product_suppliers', ['is_active'], unique=False)
    op.create_index(op.f('ix_product_suppliers_product_id'), 'product_suppliers', ['product_id'], unique=False)
    op.create_index(op.f('ix_product_suppliers_supplier_id'), 'product_suppliers', ['supplier_id'], unique=False)
    op.create_index(op.f('ix_product_suppliers_tenant_id'), 'product_suppliers', ['tenant_id'], unique=False)
    op.create_table('purchase_invoice_items',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('purchase_invoice_id', sa.Integer(), nullable=False),
    sa.Column('tenant_id', sa.String(length=36), nullable=False),
    sa.Column('branch_id', sa.String(length=50), nullable=True),
    sa.Column('product_code', sa.String(length=100), nullable=True),
    sa.Column('product_name', sa.String(length=200), nullable=False),
    sa.Column('product_description', sa.Text(), nullable=True),
    sa.Column('quantity', sa.Numeric(precision=10, scale=2), nullable=False),
    sa.Column('unit', sa.String(length=50), nullable=True),
    sa.Column('unit_price', sa.Numeric(precision=10, scale=2), nullable=False),
    sa.Column('tax_rate', sa.Integer(), nullable=True),
    sa.Column('tax_amount', sa.Numeric(precision=10, scale=2), nullable=True),
    sa.Column('line_total', sa.Numeric(precision=12, scale=2), nullable=False),
    sa.Column('inventory_id', sa.String(length=100), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=True),
    sa.Column('updated_at', sa.DateTime(), nullable=True),
    sa.ForeignKeyConstraint(['branch_id'], ['branches.id'], ),
    sa.ForeignKeyConstraint(['inventory_id'], ['inventory.id'], ),
    sa.ForeignKeyConstraint(['purchase_invoice_id'], ['purchase_invoices.id'], ),
    sa.ForeignKeyConstraint(['tenant_id'], ['tenants.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_purchase_invoice_items_branch_id'), 'purchase_invoice_items', ['branch_id'], unique=False)
    op.create_index(op.f('ix_purchase_invoice_items_purchase_invoice_id'), 'purchase_invoice_items', ['purchase_invoice_id'], unique=False)
    op.create_index(op.f('ix_purchase_invoice_items_tenant_id'), 'purchase_invoice_items', ['tenant_id'], unique=False)
    op.create_table('sales',
    sa.Column('id', sa.String(length=50), nullable=False),
    sa.Column('party_id', sa.String(length=50), nullable=False),
    sa.Column('product_id', sa.String(length=50), nullable=True),
    sa.Column('tenant_id', sa.String(length=36), nullable=False),
    sa.Column('branch_id', sa.String(length=50), nullable=True),
    sa.Column('sale_date', sa.DateTime(), nullable=False),
    sa.Column('list_price_total', sa.Numeric(precision=12, scale=2), nullable=True),
    sa.Column('total_amount', sa.Numeric(precision=12, scale=2), nullable=True),
    sa.Column('discount_amount', sa.Numeric(precision=12, scale=2), nullable=True),
    sa.Column('final_amount', sa.Numeric(precision=12, scale=2), nullable=True),
    sa.Column('paid_amount', sa.Numeric(precision=12, scale=2), nullable=True),
    sa.Column('right_ear_assignment_id', sa.String(length=50), nullable=True),
    sa.Column('left_ear_assignment_id', sa.String(length=50), nullable=True),
    sa.Column('status', sa.String(length=20), nullable=True),
    sa.Column('payment_method', sa.String(length=20), nullable=True),
    sa.Column('sgk_coverage', sa.Numeric(precision=12, scale=2), nullable=True),
    sa.Column('patient_payment', sa.Numeric(precision=12, scale=2), nullable=True),
    sa.Column('report_status', sa.String(length=50), nullable=True),
    sa.Column('notes', sa.Text(), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=True),
    sa.Column('updated_at', sa.DateTime(), nullable=True),
    sa.ForeignKeyConstraint(['branch_id'], ['branches.id'], ),
    sa.ForeignKeyConstraint(['left_ear_assignment_id'], ['device_assignments.id'], use_alter=True),
    sa.ForeignKeyConstraint(['party_id'], ['parties.id'], ),
    sa.ForeignKeyConstraint(['product_id'], ['inventory.id'], ),
    sa.ForeignKeyConstraint(['right_ear_assignment_id'], ['device_assignments.id'], use_alter=True),
    sa.ForeignKeyConstraint(['tenant_id'], ['tenants.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_sales_branch_id'), 'sales', ['branch_id'], unique=False)
    op.create_index(op.f('ix_sales_tenant_id'), 'sales', ['tenant_id'], unique=False)
    op.create_table('sms_logs',
    sa.Column('id', sa.String(length=50), nullable=False),
    sa.Column('campaign_id', sa.String(length=50), nullable=True),
    sa.Column('party_id', sa.String(length=50), nullable=True),
    sa.Column('tenant_id', sa.String(length=36), nullable=False),
    sa.Column('phone_number', sa.String(length=20), nullable=False),
    sa.Column('message', sa.Text(), nullable=False),
    sa.Column('status', sa.String(length=20), nullable=True),
    sa.Column('provider_response', sa.Text(), nullable=True),
    sa.Column('sent_at', sa.DateTime(), nullable=True),
    sa.Column('delivered_at', sa.DateTime(), nullable=True),
    sa.Column('opened_at', sa.DateTime(), nullable=True),
    sa.Column('clicked_at', sa.DateTime(), nullable=True),
    sa.Column('error_message', sa.Text(), nullable=True),
    sa.Column('retry_count', sa.Integer(), nullable=True),
    sa.Column('cost', sa.Float(), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=True),
    sa.Column('updated_at', sa.DateTime(), nullable=True),
    sa.ForeignKeyConstraint(['campaign_id'], ['campaigns.id'], ),
    sa.ForeignKeyConstraint(['party_id'], ['parties.id'], ),
    sa.ForeignKeyConstraint(['tenant_id'], ['tenants.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_sms_campaign', 'sms_logs', ['campaign_id'], unique=False)
    op.create_index(op.f('ix_sms_logs_tenant_id'), 'sms_logs', ['tenant_id'], unique=False)
    op.create_index('ix_sms_patient', 'sms_logs', ['party_id'], unique=False)
    op.create_index('ix_sms_sent_at', 'sms_logs', ['sent_at'], unique=False)
    op.create_index('ix_sms_status', 'sms_logs', ['status'], unique=False)
    op.create_table('stock_movements',
    sa.Column('id', sa.String(length=50), nullable=False),
    sa.Column('tenant_id', sa.String(length=36), nullable=False),
    sa.Column('inventory_id', sa.String(length=50), nullable=False),
    sa.Column('transaction_id', sa.String(length=50), nullable=True),
    sa.Column('movement_type', sa.String(length=20), nullable=False),
    sa.Column('quantity', sa.Integer(), nullable=False),
    sa.Column('serial_number', sa.String(length=100), nullable=True),
    sa.Column('created_by', sa.String(length=50), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=True),
    sa.Column('updated_at', sa.DateTime(), nullable=True),
    sa.ForeignKeyConstraint(['inventory_id'], ['inventory.id'], ),
    sa.ForeignKeyConstraint(['tenant_id'], ['tenants.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_stock_movements_inventory_id'), 'stock_movements', ['inventory_id'], unique=False)
    op.create_index(op.f('ix_stock_movements_movement_type'), 'stock_movements', ['movement_type'], unique=False)
    op.create_index(op.f('ix_stock_movements_tenant_id'), 'stock_movements', ['tenant_id'], unique=False)
    op.create_index(op.f('ix_stock_movements_transaction_id'), 'stock_movements', ['transaction_id'], unique=False)
    op.create_table('user_app_roles',
    sa.Column('id', sa.String(length=50), nullable=False),
    sa.Column('user_id', sa.String(length=50), nullable=False),
    sa.Column('app_id', sa.String(length=50), nullable=False),
    sa.Column('role_id', sa.String(length=50), nullable=False),
    sa.Column('created_at', sa.DateTime(), nullable=True),
    sa.Column('updated_at', sa.DateTime(), nullable=True),
    sa.ForeignKeyConstraint(['app_id'], ['apps.id'], ),
    sa.ForeignKeyConstraint(['role_id'], ['roles.id'], ),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('user_id', 'app_id', 'role_id', name='uq_user_app_role')
    )
    op.create_table('communication_history',
    sa.Column('id', sa.String(length=50), nullable=False),
    sa.Column('party_id', sa.String(length=50), nullable=False),
    sa.Column('campaign_id', sa.String(length=50), nullable=True),
    sa.Column('template_id', sa.String(length=50), nullable=True),
    sa.Column('tenant_id', sa.String(length=36), nullable=False),
    sa.Column('sms_log_id', sa.String(length=50), nullable=True),
    sa.Column('email_log_id', sa.String(length=50), nullable=True),
    sa.Column('communication_type', sa.String(length=20), nullable=False),
    sa.Column('direction', sa.String(length=10), nullable=False),
    sa.Column('subject', sa.String(length=500), nullable=True),
    sa.Column('content', sa.Text(), nullable=True),
    sa.Column('contact_method', sa.String(length=255), nullable=True),
    sa.Column('status', sa.String(length=20), nullable=True),
    sa.Column('priority', sa.String(length=20), nullable=True),
    sa.Column('comm_metadata', sa.Text(), nullable=True),
    sa.Column('initiated_by', sa.String(length=50), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=True),
    sa.Column('updated_at', sa.DateTime(), nullable=True),
    sa.ForeignKeyConstraint(['campaign_id'], ['campaigns.id'], ),
    sa.ForeignKeyConstraint(['email_log_id'], ['email_logs.id'], ),
    sa.ForeignKeyConstraint(['party_id'], ['parties.id'], ),
    sa.ForeignKeyConstraint(['sms_log_id'], ['sms_logs.id'], ),
    sa.ForeignKeyConstraint(['template_id'], ['communication_templates.id'], ),
    sa.ForeignKeyConstraint(['tenant_id'], ['tenants.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_comm_history_created', 'communication_history', ['created_at'], unique=False)
    op.create_index('ix_comm_history_direction', 'communication_history', ['direction'], unique=False)
    op.create_index('ix_comm_history_patient', 'communication_history', ['party_id'], unique=False)
    op.create_index('ix_comm_history_status', 'communication_history', ['status'], unique=False)
    op.create_index('ix_comm_history_type', 'communication_history', ['communication_type'], unique=False)
    op.create_index(op.f('ix_communication_history_tenant_id'), 'communication_history', ['tenant_id'], unique=False)
    op.create_table('device_assignments',
    sa.Column('id', sa.String(length=50), nullable=False),
    sa.Column('assignment_uid', sa.String(length=20), nullable=True),
    sa.Column('party_id', sa.String(length=50), nullable=False),
    sa.Column('device_id', sa.String(length=50), nullable=True),
    sa.Column('sale_id', sa.String(length=50), nullable=True),
    sa.Column('inventory_id', sa.String(length=50), nullable=True),
    sa.Column('tenant_id', sa.String(length=36), nullable=False),
    sa.Column('branch_id', sa.String(length=50), nullable=True),
    sa.Column('ear', sa.String(length=1), nullable=True),
    sa.Column('reason', sa.String(length=50), nullable=True),
    sa.Column('from_inventory', sa.Boolean(), nullable=True),
    sa.Column('serial_number', sa.String(length=100), nullable=True),
    sa.Column('serial_number_left', sa.String(length=100), nullable=True),
    sa.Column('serial_number_right', sa.String(length=100), nullable=True),
    sa.Column('list_price', sa.Numeric(precision=12, scale=2), nullable=True),
    sa.Column('sale_price', sa.Numeric(precision=12, scale=2), nullable=True),
    sa.Column('sgk_scheme', sa.String(length=50), nullable=True),
    sa.Column('sgk_support', sa.Numeric(precision=12, scale=2), nullable=True),
    sa.Column('discount_type', sa.String(length=10), nullable=True),
    sa.Column('discount_value', sa.Numeric(precision=12, scale=2), nullable=True),
    sa.Column('net_payable', sa.Numeric(precision=12, scale=2), nullable=True),
    sa.Column('payment_method', sa.String(length=20), nullable=True),
    sa.Column('delivery_status', sa.String(length=20), nullable=True),
    sa.Column('is_loaner', sa.Boolean(), nullable=True),
    sa.Column('loaner_inventory_id', sa.String(length=50), nullable=True),
    sa.Column('loaner_serial_number', sa.String(length=100), nullable=True),
    sa.Column('loaner_serial_number_left', sa.String(length=100), nullable=True),
    sa.Column('loaner_serial_number_right', sa.String(length=100), nullable=True),
    sa.Column('loaner_brand', sa.String(length=100), nullable=True),
    sa.Column('loaner_model', sa.String(length=100), nullable=True),
    sa.Column('report_status', sa.String(length=50), nullable=True),
    sa.Column('notes', sa.Text(), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=True),
    sa.Column('updated_at', sa.DateTime(), nullable=True),
    sa.ForeignKeyConstraint(['branch_id'], ['branches.id'], ),
    sa.ForeignKeyConstraint(['inventory_id'], ['inventory.id'], ),
    sa.ForeignKeyConstraint(['loaner_inventory_id'], ['inventory.id'], ),
    sa.ForeignKeyConstraint(['party_id'], ['parties.id'], ),
    sa.ForeignKeyConstraint(['sale_id'], ['sales.id'], ),
    sa.ForeignKeyConstraint(['tenant_id'], ['tenants.id'], ),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('assignment_uid')
    )
    op.create_index(op.f('ix_device_assignments_branch_id'), 'device_assignments', ['branch_id'], unique=False)
    op.create_index(op.f('ix_device_assignments_tenant_id'), 'device_assignments', ['tenant_id'], unique=False)
    op.create_table('device_replacements',
    sa.Column('id', sa.String(length=50), nullable=False),
    sa.Column('party_id', sa.String(length=50), nullable=False),
    sa.Column('old_device_id', sa.String(length=50), nullable=False),
    sa.Column('new_inventory_id', sa.String(length=50), nullable=False),
    sa.Column('tenant_id', sa.String(length=36), nullable=False),
    sa.Column('old_device_info', sa.Text(), nullable=True),
    sa.Column('new_device_info', sa.Text(), nullable=True),
    sa.Column('status', sa.String(length=50), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=True),
    sa.Column('updated_at', sa.DateTime(), nullable=True),
    sa.ForeignKeyConstraint(['old_device_id'], ['devices.id'], ),
    sa.ForeignKeyConstraint(['party_id'], ['parties.id'], ),
    sa.ForeignKeyConstraint(['tenant_id'], ['tenants.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_device_replacements_tenant_id'), 'device_replacements', ['tenant_id'], unique=False)
    op.create_table('invoices',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('invoice_number', sa.String(length=50), nullable=False),
    sa.Column('sale_id', sa.String(length=50), nullable=True),
    sa.Column('party_id', sa.String(length=50), nullable=True),
    sa.Column('device_id', sa.String(length=50), nullable=True),
    sa.Column('tenant_id', sa.String(length=36), nullable=False),
    sa.Column('branch_id', sa.String(length=50), nullable=True),
    sa.Column('device_name', sa.String(length=200), nullable=True),
    sa.Column('device_serial', sa.String(length=100), nullable=True),
    sa.Column('device_price', sa.Numeric(precision=12, scale=2), nullable=False),
    sa.Column('patient_name', sa.String(length=200), nullable=True),
    sa.Column('patient_tc', sa.String(length=11), nullable=True),
    sa.Column('status', sa.String(length=20), nullable=True),
    sa.Column('sent_to_gib', sa.Boolean(), nullable=True),
    sa.Column('sent_to_gib_at', sa.DateTime(), nullable=True),
    sa.Column('notes', sa.Text(), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=False),
    sa.Column('updated_at', sa.DateTime(), nullable=True),
    sa.Column('created_by', sa.String(length=100), nullable=True),
    sa.Column('edocument_status', sa.String(length=20), nullable=True),
    sa.Column('edocument_type', sa.String(length=20), nullable=True),
    sa.Column('ettn', sa.String(length=100), nullable=True),
    sa.Column('profile_id', sa.String(length=50), nullable=True),
    sa.Column('invoice_type_code', sa.String(length=20), nullable=True),
    sa.Column('qr_code_data', sa.Text(), nullable=True),
    sa.Column('birfatura_response', sa.Text(), nullable=True),
    sa.Column('gib_pdf_data', sa.Text(), nullable=True),
    sa.Column('gib_pdf_link', sa.String(length=500), nullable=True),
    sa.Column('gib_xml_data', sa.Text(), nullable=True),
    sa.Column('birfatura_sent_at', sa.DateTime(), nullable=True),
    sa.Column('birfatura_approved_at', sa.DateTime(), nullable=True),
    sa.ForeignKeyConstraint(['branch_id'], ['branches.id'], ),
    sa.ForeignKeyConstraint(['device_id'], ['devices.id'], ),
    sa.ForeignKeyConstraint(['party_id'], ['parties.id'], ),
    sa.ForeignKeyConstraint(['sale_id'], ['sales.id'], ),
    sa.ForeignKeyConstraint(['tenant_id'], ['tenants.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_invoices_branch_id'), 'invoices', ['branch_id'], unique=False)
    op.create_index(op.f('ix_invoices_created_at'), 'invoices', ['created_at'], unique=False)
    op.create_index(op.f('ix_invoices_ettn'), 'invoices', ['ettn'], unique=True)
    op.create_index(op.f('ix_invoices_invoice_number'), 'invoices', ['invoice_number'], unique=True)
    op.create_index(op.f('ix_invoices_party_id'), 'invoices', ['party_id'], unique=False)
    op.create_index(op.f('ix_invoices_sale_id'), 'invoices', ['sale_id'], unique=False)
    op.create_index(op.f('ix_invoices_tenant_id'), 'invoices', ['tenant_id'], unique=False)
    op.create_table('payment_plans',
    sa.Column('id', sa.String(length=50), nullable=False),
    sa.Column('sale_id', sa.String(length=50), nullable=False),
    sa.Column('tenant_id', sa.String(length=36), nullable=False),
    sa.Column('branch_id', sa.String(length=50), nullable=True),
    sa.Column('plan_name', sa.String(length=100), nullable=False),
    sa.Column('total_amount', sa.Float(), nullable=False),
    sa.Column('installment_count', sa.Integer(), nullable=False),
    sa.Column('installment_amount', sa.Float(), nullable=False),
    sa.Column('interest_rate', sa.Float(), nullable=True),
    sa.Column('processing_fee', sa.Float(), nullable=True),
    sa.Column('status', sa.String(length=20), nullable=True),
    sa.Column('start_date', sa.DateTime(), nullable=False),
    sa.Column('created_at', sa.DateTime(), nullable=True),
    sa.Column('updated_at', sa.DateTime(), nullable=True),
    sa.ForeignKeyConstraint(['branch_id'], ['branches.id'], ),
    sa.ForeignKeyConstraint(['sale_id'], ['sales.id'], ),
    sa.ForeignKeyConstraint(['tenant_id'], ['tenants.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_payment_plans_branch_id'), 'payment_plans', ['branch_id'], unique=False)
    op.create_index(op.f('ix_payment_plans_tenant_id'), 'payment_plans', ['tenant_id'], unique=False)
    op.create_table('payment_records',
    sa.Column('id', sa.String(length=50), nullable=False),
    sa.Column('party_id', sa.String(length=50), nullable=True),
    sa.Column('sale_id', sa.String(length=50), nullable=True),
    sa.Column('promissory_note_id', sa.String(length=50), nullable=True),
    sa.Column('tenant_id', sa.String(length=36), nullable=False),
    sa.Column('branch_id', sa.String(length=50), nullable=True),
    sa.Column('amount', sa.Numeric(precision=12, scale=2), nullable=False),
    sa.Column('payment_date', sa.DateTime(), nullable=False),
    sa.Column('due_date', sa.DateTime(), nullable=True),
    sa.Column('payment_method', sa.String(length=20), nullable=False),
    sa.Column('payment_type', sa.String(length=20), nullable=True),
    sa.Column('status', sa.String(length=20), nullable=True),
    sa.Column('reference_number', sa.String(length=100), nullable=True),
    sa.Column('pos_provider', sa.String(length=50), nullable=True),
    sa.Column('pos_transaction_id', sa.String(length=100), nullable=True),
    sa.Column('pos_status', sa.String(length=50), nullable=True),
    sa.Column('installment_count', sa.Integer(), nullable=True),
    sa.Column('is_3d_secure', sa.Boolean(), nullable=True),
    sa.Column('pos_raw_response', sa.JSON(), nullable=True),
    sa.Column('gross_amount', sa.Numeric(precision=12, scale=2), nullable=True),
    sa.Column('net_amount', sa.Numeric(precision=12, scale=2), nullable=True),
    sa.Column('error_message', sa.Text(), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=True),
    sa.Column('updated_at', sa.DateTime(), nullable=True),
    sa.ForeignKeyConstraint(['branch_id'], ['branches.id'], ),
    sa.ForeignKeyConstraint(['party_id'], ['parties.id'], ),
    sa.ForeignKeyConstraint(['sale_id'], ['sales.id'], ),
    sa.ForeignKeyConstraint(['tenant_id'], ['tenants.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_payment_records_branch_id'), 'payment_records', ['branch_id'], unique=False)
    op.create_index(op.f('ix_payment_records_pos_transaction_id'), 'payment_records', ['pos_transaction_id'], unique=False)
    op.create_index(op.f('ix_payment_records_tenant_id'), 'payment_records', ['tenant_id'], unique=False)
    op.create_table('promissory_notes',
    sa.Column('id', sa.String(length=50), nullable=False),
    sa.Column('party_id', sa.String(length=50), nullable=False),
    sa.Column('sale_id', sa.String(length=50), nullable=True),
    sa.Column('tenant_id', sa.String(length=36), nullable=False),
    sa.Column('note_number', sa.Integer(), nullable=False),
    sa.Column('total_notes', sa.Integer(), nullable=False),
    sa.Column('amount', sa.Numeric(precision=12, scale=2), nullable=False),
    sa.Column('paid_amount', sa.Numeric(precision=12, scale=2), nullable=True),
    sa.Column('total_amount', sa.Numeric(precision=12, scale=2), nullable=False),
    sa.Column('issue_date', sa.DateTime(), nullable=False),
    sa.Column('due_date', sa.DateTime(), nullable=False),
    sa.Column('status', sa.String(length=20), nullable=True),
    sa.Column('paid_date', sa.DateTime(), nullable=True),
    sa.Column('debtor_name', sa.String(length=200), nullable=False),
    sa.Column('debtor_tc', sa.String(length=11), nullable=True),
    sa.Column('debtor_address', sa.Text(), nullable=True),
    sa.Column('debtor_tax_office', sa.String(length=100), nullable=True),
    sa.Column('debtor_phone', sa.String(length=20), nullable=True),
    sa.Column('has_guarantor', sa.Boolean(), nullable=True),
    sa.Column('guarantor_name', sa.String(length=200), nullable=True),
    sa.Column('guarantor_tc', sa.String(length=11), nullable=True),
    sa.Column('guarantor_address', sa.Text(), nullable=True),
    sa.Column('guarantor_phone', sa.String(length=20), nullable=True),
    sa.Column('authorized_court', sa.String(length=200), nullable=True),
    sa.Column('document_id', sa.String(length=50), nullable=True),
    sa.Column('file_name', sa.String(length=255), nullable=True),
    sa.Column('notes', sa.Text(), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=True),
    sa.Column('updated_at', sa.DateTime(), nullable=True),
    sa.ForeignKeyConstraint(['party_id'], ['parties.id'], ),
    sa.ForeignKeyConstraint(['sale_id'], ['sales.id'], ),
    sa.ForeignKeyConstraint(['tenant_id'], ['tenants.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_promissory_note_due_date', 'promissory_notes', ['due_date'], unique=False)
    op.create_index('ix_promissory_note_patient', 'promissory_notes', ['party_id'], unique=False)
    op.create_index('ix_promissory_note_sale', 'promissory_notes', ['sale_id'], unique=False)
    op.create_index('ix_promissory_note_status', 'promissory_notes', ['status'], unique=False)
    op.create_index(op.f('ix_promissory_notes_tenant_id'), 'promissory_notes', ['tenant_id'], unique=False)
    op.create_table('payment_installments',
    sa.Column('id', sa.String(length=50), nullable=False),
    sa.Column('payment_plan_id', sa.String(length=50), nullable=False),
    sa.Column('installment_number', sa.Integer(), nullable=False),
    sa.Column('due_date', sa.DateTime(), nullable=False),
    sa.Column('amount', sa.Float(), nullable=False),
    sa.Column('paid_date', sa.DateTime(), nullable=True),
    sa.Column('paid_amount', sa.Float(), nullable=True),
    sa.Column('status', sa.String(length=20), nullable=True),
    sa.Column('late_fee', sa.Float(), nullable=True),
    sa.Column('notes', sa.Text(), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=True),
    sa.Column('updated_at', sa.DateTime(), nullable=True),
    sa.ForeignKeyConstraint(['payment_plan_id'], ['payment_plans.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_installment_due_date', 'payment_installments', ['due_date'], unique=False)
    op.create_index('ix_installment_plan', 'payment_installments', ['payment_plan_id'], unique=False)
    op.create_index('ix_installment_status', 'payment_installments', ['status'], unique=False)
    op.create_table('proformas',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('proforma_number', sa.String(length=50), nullable=False),
    sa.Column('party_id', sa.String(length=50), nullable=True),
    sa.Column('tenant_id', sa.String(length=36), nullable=False),
    sa.Column('branch_id', sa.String(length=50), nullable=True),
    sa.Column('company_name', sa.String(length=200), nullable=True),
    sa.Column('device_name', sa.String(length=200), nullable=True),
    sa.Column('device_serial', sa.String(length=100), nullable=True),
    sa.Column('device_price', sa.Numeric(precision=12, scale=2), nullable=False),
    sa.Column('devices', sa.Text(), nullable=True),
    sa.Column('patient_name', sa.String(length=200), nullable=True),
    sa.Column('patient_tc', sa.String(length=11), nullable=True),
    sa.Column('status', sa.String(length=20), nullable=True),
    sa.Column('notes', sa.Text(), nullable=True),
    sa.Column('valid_until', sa.DateTime(), nullable=True),
    sa.Column('converted_to_invoice_id', sa.Integer(), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=False),
    sa.Column('updated_at', sa.DateTime(), nullable=True),
    sa.Column('created_by', sa.String(length=100), nullable=True),
    sa.ForeignKeyConstraint(['branch_id'], ['branches.id'], ),
    sa.ForeignKeyConstraint(['converted_to_invoice_id'], ['invoices.id'], ),
    sa.ForeignKeyConstraint(['party_id'], ['parties.id'], ),
    sa.ForeignKeyConstraint(['tenant_id'], ['tenants.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_proformas_branch_id'), 'proformas', ['branch_id'], unique=False)
    op.create_index(op.f('ix_proformas_created_at'), 'proformas', ['created_at'], unique=False)
    op.create_index(op.f('ix_proformas_party_id'), 'proformas', ['party_id'], unique=False)
    op.create_index(op.f('ix_proformas_proforma_number'), 'proformas', ['proforma_number'], unique=True)
    op.create_index(op.f('ix_proformas_tenant_id'), 'proformas', ['tenant_id'], unique=False)
    op.create_table('return_invoices',
    sa.Column('id', sa.String(length=50), nullable=False),
    sa.Column('replacement_id', sa.String(length=50), nullable=False),
    sa.Column('tenant_id', sa.String(length=36), nullable=False),
    sa.Column('invoice_number', sa.String(length=100), nullable=False),
    sa.Column('supplier_name', sa.String(length=255), nullable=True),
    sa.Column('supplier_invoice_id', sa.String(length=50), nullable=True),
    sa.Column('supplier_invoice_number', sa.String(length=100), nullable=True),
    sa.Column('supplier_invoice_date', sa.Date(), nullable=True),
    sa.Column('invoice_note', sa.Text(), nullable=True),
    sa.Column('gib_sent', sa.Boolean(), nullable=True),
    sa.Column('gib_sent_date', sa.DateTime(), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=True),
    sa.Column('updated_at', sa.DateTime(), nullable=True),
    sa.ForeignKeyConstraint(['replacement_id'], ['device_replacements.id'], ),
    sa.ForeignKeyConstraint(['tenant_id'], ['tenants.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_return_invoices_tenant_id'), 'return_invoices', ['tenant_id'], unique=False)
    # ### end Alembic commands ###


def downgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    op.drop_index(op.f('ix_return_invoices_tenant_id'), table_name='return_invoices')
    op.drop_table('return_invoices')
    op.drop_index(op.f('ix_proformas_tenant_id'), table_name='proformas')
    op.drop_index(op.f('ix_proformas_proforma_number'), table_name='proformas')
    op.drop_index(op.f('ix_proformas_party_id'), table_name='proformas')
    op.drop_index(op.f('ix_proformas_created_at'), table_name='proformas')
    op.drop_index(op.f('ix_proformas_branch_id'), table_name='proformas')
    op.drop_table('proformas')
    op.drop_index('ix_installment_status', table_name='payment_installments')
    op.drop_index('ix_installment_plan', table_name='payment_installments')
    op.drop_index('ix_installment_due_date', table_name='payment_installments')
    op.drop_table('payment_installments')
    op.drop_index(op.f('ix_promissory_notes_tenant_id'), table_name='promissory_notes')
    op.drop_index('ix_promissory_note_status', table_name='promissory_notes')
    op.drop_index('ix_promissory_note_sale', table_name='promissory_notes')
    op.drop_index('ix_promissory_note_patient', table_name='promissory_notes')
    op.drop_index('ix_promissory_note_due_date', table_name='promissory_notes')
    op.drop_table('promissory_notes')
    op.drop_index(op.f('ix_payment_records_tenant_id'), table_name='payment_records')
    op.drop_index(op.f('ix_payment_records_pos_transaction_id'), table_name='payment_records')
    op.drop_index(op.f('ix_payment_records_branch_id'), table_name='payment_records')
    op.drop_table('payment_records')
    op.drop_index(op.f('ix_payment_plans_tenant_id'), table_name='payment_plans')
    op.drop_index(op.f('ix_payment_plans_branch_id'), table_name='payment_plans')
    op.drop_table('payment_plans')
    op.drop_index(op.f('ix_invoices_tenant_id'), table_name='invoices')
    op.drop_index(op.f('ix_invoices_sale_id'), table_name='invoices')
    op.drop_index(op.f('ix_invoices_party_id'), table_name='invoices')
    op.drop_index(op.f('ix_invoices_invoice_number'), table_name='invoices')
    op.drop_index(op.f('ix_invoices_ettn'), table_name='invoices')
    op.drop_index(op.f('ix_invoices_created_at'), table_name='invoices')
    op.drop_index(op.f('ix_invoices_branch_id'), table_name='invoices')
    op.drop_table('invoices')
    op.drop_index(op.f('ix_device_replacements_tenant_id'), table_name='device_replacements')
    op.drop_table('device_replacements')
    op.drop_index(op.f('ix_device_assignments_tenant_id'), table_name='device_assignments')
    op.drop_index(op.f('ix_device_assignments_branch_id'), table_name='device_assignments')
    op.drop_table('device_assignments')
    op.drop_index(op.f('ix_communication_history_tenant_id'), table_name='communication_history')
    op.drop_index('ix_comm_history_type', table_name='communication_history')
    op.drop_index('ix_comm_history_status', table_name='communication_history')
    op.drop_index('ix_comm_history_patient', table_name='communication_history')
    op.drop_index('ix_comm_history_direction', table_name='communication_history')
    op.drop_index('ix_comm_history_created', table_name='communication_history')
    op.drop_table('communication_history')
    op.drop_table('user_app_roles')
    op.drop_index(op.f('ix_stock_movements_transaction_id'), table_name='stock_movements')
    op.drop_index(op.f('ix_stock_movements_tenant_id'), table_name='stock_movements')
    op.drop_index(op.f('ix_stock_movements_movement_type'), table_name='stock_movements')
    op.drop_index(op.f('ix_stock_movements_inventory_id'), table_name='stock_movements')
    op.drop_table('stock_movements')
    op.drop_index('ix_sms_status', table_name='sms_logs')
    op.drop_index('ix_sms_sent_at', table_name='sms_logs')
    op.drop_index('ix_sms_patient', table_name='sms_logs')
    op.drop_index(op.f('ix_sms_logs_tenant_id'), table_name='sms_logs')
    op.drop_index('ix_sms_campaign', table_name='sms_logs')
    op.drop_table('sms_logs')
    op.drop_index(op.f('ix_sales_tenant_id'), table_name='sales')
    op.drop_index(op.f('ix_sales_branch_id'), table_name='sales')
    op.drop_table('sales')
    op.drop_index(op.f('ix_purchase_invoice_items_tenant_id'), table_name='purchase_invoice_items')
    op.drop_index(op.f('ix_purchase_invoice_items_purchase_invoice_id'), table_name='purchase_invoice_items')
    op.drop_index(op.f('ix_purchase_invoice_items_branch_id'), table_name='purchase_invoice_items')
    op.drop_table('purchase_invoice_items')
    op.drop_index(op.f('ix_product_suppliers_tenant_id'), table_name='product_suppliers')
    op.drop_index(op.f('ix_product_suppliers_supplier_id'), table_name='product_suppliers')
    op.drop_index(op.f('ix_product_suppliers_product_id'), table_name='product_suppliers')
    op.drop_index(op.f('ix_product_suppliers_is_active'), table_name='product_suppliers')
    op.drop_table('product_suppliers')
    op.drop_index(op.f('ix_patient_notes_tenant_id'), table_name='patient_notes')
    op.drop_table('patient_notes')
    op.drop_index(op.f('ix_party_roles_tenant_id'), table_name='party_roles')
    op.drop_index(op.f('ix_party_roles_party_id'), table_name='party_roles')
    op.drop_table('party_roles')
    op.drop_index(op.f('ix_hearing_tests_tenant_id'), table_name='hearing_tests')
    op.drop_index('ix_hearing_test_patient', table_name='hearing_tests')
    op.drop_index('ix_hearing_test_date', table_name='hearing_tests')
    op.drop_table('hearing_tests')
    op.drop_index(op.f('ix_ereceipts_tenant_id'), table_name='ereceipts')
    op.drop_table('ereceipts')
    op.drop_index('ix_email_to_email', table_name='email_logs')
    op.drop_index('ix_email_template', table_name='email_logs')
    op.drop_index('ix_email_status', table_name='email_logs')
    op.drop_index('ix_email_sent_at', table_name='email_logs')
    op.drop_index('ix_email_patient', table_name='email_logs')
    op.drop_index(op.f('ix_email_logs_tenant_id'), table_name='email_logs')
    op.drop_index('ix_email_campaign', table_name='email_logs')
    op.drop_table('email_logs')
    op.drop_index('ix_device_status', table_name='devices')
    op.drop_index('ix_device_serial_right', table_name='devices')
    op.drop_index('ix_device_serial_left', table_name='devices')
    op.drop_index('ix_device_serial', table_name='devices')
    op.drop_index('ix_device_patient', table_name='devices')
    op.drop_index('ix_device_category', table_name='devices')
    op.drop_table('devices')
    op.drop_index(op.f('ix_appointments_tenant_id'), table_name='appointments')
    op.drop_index('ix_appointment_status', table_name='appointments')
    op.drop_index('ix_appointment_patient', table_name='appointments')
    op.drop_index('ix_appointment_date', table_name='appointments')
    op.drop_table('appointments')
    op.drop_table('user_branches')
    op.drop_index(op.f('ix_suggested_suppliers_tenant_id'), table_name='suggested_suppliers')
    op.drop_index(op.f('ix_suggested_suppliers_tax_number'), table_name='suggested_suppliers')
    op.drop_index(op.f('ix_suggested_suppliers_branch_id'), table_name='suggested_suppliers')
    op.drop_table('suggested_suppliers')
    op.drop_index(op.f('ix_purchase_invoices_tenant_id'), table_name='purchase_invoices')
    op.drop_index(op.f('ix_purchase_invoices_supplier_id'), table_name='purchase_invoices')
    op.drop_index(op.f('ix_purchase_invoices_sender_tax_number'), table_name='purchase_invoices')
    op.drop_index(op.f('ix_purchase_invoices_invoice_number'), table_name='purchase_invoices')
    op.drop_index(op.f('ix_purchase_invoices_invoice_date'), table_name='purchase_invoices')
    op.drop_index(op.f('ix_purchase_invoices_branch_id'), table_name='purchase_invoices')
    op.drop_index(op.f('ix_purchase_invoices_birfatura_uuid'), table_name='purchase_invoices')
    op.drop_table('purchase_invoices')
    op.drop_index(op.f('ix_payment_history_tenant_id'), table_name='payment_history')
    op.drop_index(op.f('ix_payment_history_provider_payment_id'), table_name='payment_history')
    op.drop_table('payment_history')
    op.drop_index(op.f('ix_parties_tenant_id'), table_name='parties')
    op.drop_index(op.f('ix_parties_branch_id'), table_name='parties')
    op.drop_table('parties')
    op.drop_table('marketplace_products')
    op.drop_index(op.f('ix_inventory_tenant_id'), table_name='inventory')
    op.drop_index(op.f('ix_inventory_branch_id'), table_name='inventory')
    op.drop_table('inventory')
    op.drop_table('apps')
    op.drop_index(op.f('ix_api_keys_tenant_id'), table_name='api_keys')
    op.drop_index(op.f('ix_api_keys_key_hash'), table_name='api_keys')
    op.drop_table('api_keys')
    op.drop_index('ix_activity_user', table_name='activity_logs')
    op.drop_index('ix_activity_tenant_created', table_name='activity_logs')
    op.drop_index('ix_activity_tenant_action', table_name='activity_logs')
    op.drop_index(op.f('ix_activity_logs_tenant_id'), table_name='activity_logs')
    op.drop_index(op.f('ix_activity_logs_is_critical'), table_name='activity_logs')
    op.drop_index('ix_activity_entity', table_name='activity_logs')
    op.drop_index('ix_activity_created', table_name='activity_logs')
    op.drop_index('ix_activity_action', table_name='activity_logs')
    op.drop_table('activity_logs')
    op.drop_index(op.f('ix_users_tenant_id'), table_name='users')
    op.drop_index(op.f('ix_users_affiliate_code'), table_name='users')
    op.drop_table('users')
    op.drop_index(op.f('ix_tenant_smtp_config_tenant_id'), table_name='tenant_smtp_config')
    op.drop_index('ix_tenant_smtp_config_tenant_active', table_name='tenant_smtp_config')
    op.drop_index(op.f('ix_tenant_smtp_config_is_active'), table_name='tenant_smtp_config')
    op.drop_table('tenant_smtp_config')
    op.drop_index(op.f('ix_tenant_sms_credits_tenant_id'), table_name='tenant_sms_credits')
    op.drop_table('tenant_sms_credits')
    op.drop_index(op.f('ix_target_audiences_tenant_id'), table_name='target_audiences')
    op.drop_table('target_audiences')
    op.drop_index(op.f('ix_suppliers_tenant_id'), table_name='suppliers')
    op.drop_index(op.f('ix_suppliers_is_active'), table_name='suppliers')
    op.drop_index(op.f('ix_suppliers_email'), table_name='suppliers')
    op.drop_index(op.f('ix_suppliers_company_name'), table_name='suppliers')
    op.drop_index(op.f('ix_suppliers_company_code'), table_name='suppliers')
    op.drop_table('suppliers')
    op.drop_index(op.f('ix_subscriptions_tenant_id'), table_name='subscriptions')
    op.drop_index(op.f('ix_subscriptions_provider_subscription_id'), table_name='subscriptions')
    op.drop_table('subscriptions')
    op.drop_index('ix_smtp_email_log_tenant_status_sent', table_name='smtp_email_log')
    op.drop_index('ix_smtp_email_log_tenant_idempotency', table_name='smtp_email_log')
    op.drop_index(op.f('ix_smtp_email_log_tenant_id'), table_name='smtp_email_log')
    op.drop_index(op.f('ix_smtp_email_log_status'), table_name='smtp_email_log')
    op.drop_index(op.f('ix_smtp_email_log_sent_at'), table_name='smtp_email_log')
    op.drop_index(op.f('ix_smtp_email_log_recipient'), table_name='smtp_email_log')
    op.drop_index(op.f('ix_smtp_email_log_idempotency_key'), table_name='smtp_email_log')
    op.drop_table('smtp_email_log')
    op.drop_index(op.f('ix_sms_provider_configs_tenant_id'), table_name='sms_provider_configs')
    op.drop_table('sms_provider_configs')
    op.drop_index(op.f('ix_sms_header_requests_tenant_id'), table_name='sms_header_requests')
    op.drop_table('sms_header_requests')
    op.drop_table('ocr_jobs')
    op.drop_index(op.f('ix_notifications_tenant_id'), table_name='notifications')
    op.drop_index('ix_notification_user', table_name='notifications')
    op.drop_index('ix_notification_type', table_name='notifications')
    op.drop_index('ix_notification_read', table_name='notifications')
    op.drop_index('ix_notification_priority', table_name='notifications')
    op.drop_table('notifications')
    op.drop_index(op.f('ix_marketplace_integrations_tenant_id'), table_name='marketplace_integrations')
    op.drop_table('marketplace_integrations')
    op.drop_index(op.f('ix_hearing_profiles_tenant_id'), table_name='hearing_profiles')
    op.drop_index(op.f('ix_hearing_profiles_party_id'), table_name='hearing_profiles')
    op.drop_table('hearing_profiles')
    op.drop_index(op.f('ix_efatura_outbox_tenant_id'), table_name='efatura_outbox')
    op.drop_index(op.f('ix_efatura_outbox_replacement_id'), table_name='efatura_outbox')
    op.drop_index(op.f('ix_efatura_outbox_invoice_id'), table_name='efatura_outbox')
    op.drop_table('efatura_outbox')
    op.drop_index('ix_template_type', table_name='communication_templates')
    op.drop_index('ix_template_system', table_name='communication_templates')
    op.drop_index('ix_template_category', table_name='communication_templates')
    op.drop_index('ix_template_active', table_name='communication_templates')
    op.drop_index(op.f('ix_communication_templates_tenant_id'), table_name='communication_templates')
    op.drop_table('communication_templates')
    op.drop_index(op.f('ix_campaigns_tenant_id'), table_name='campaigns')
    op.drop_table('campaigns')
    op.drop_index(op.f('ix_branches_tenant_id'), table_name='branches')
    op.drop_table('branches')
    op.drop_index(op.f('ix_tenants_tenant_type'), table_name='tenants')
    op.drop_index(op.f('ix_tenants_status'), table_name='tenants')
    op.drop_index(op.f('ix_tenants_slug'), table_name='tenants')
    op.drop_index(op.f('ix_tenants_product_code'), table_name='tenants')
    op.drop_index(op.f('ix_tenants_name'), table_name='tenants')
    op.drop_index(op.f('ix_tenants_affiliate_id'), table_name='tenants')
    op.drop_index('idx_tenants_status', table_name='tenants')
    op.drop_index('idx_tenants_slug', table_name='tenants')
    op.drop_table('tenants')
    op.drop_table('role_permissions')
    op.drop_index(op.f('ix_commission_ledger_tenant_id'), table_name='commission_ledger')
    op.drop_index(op.f('ix_commission_ledger_affiliate_id'), table_name='commission_ledger')
    op.drop_table('commission_ledger')
    op.drop_index(op.f('ix_ai_actions_user_id'), table_name='ai_actions')
    op.drop_index('ix_ai_actions_tenant_status', table_name='ai_actions')
    op.drop_index(op.f('ix_ai_actions_tenant_id'), table_name='ai_actions')
    op.drop_index('ix_ai_actions_tenant_created', table_name='ai_actions')
    op.drop_index(op.f('ix_ai_actions_request_id'), table_name='ai_actions')
    op.drop_index(op.f('ix_ai_actions_idempotency_key'), table_name='ai_actions')
    op.drop_index('ix_ai_actions_approval_pending', table_name='ai_actions')
    op.drop_index(op.f('ix_ai_actions_action_plan_hash'), table_name='ai_actions')
    op.drop_table('ai_actions')
    op.drop_table('admin_user_roles')
    op.drop_table('admin_role_permissions')
    op.drop_table('system_settings')
    op.drop_table('sms_packages')
    op.drop_table('settings')
    op.drop_table('scan_queue')
    op.drop_table('roles')
    op.drop_index(op.f('ix_replacements_tenant_id'), table_name='replacements')
    op.drop_index(op.f('ix_replacements_status'), table_name='replacements')
    op.drop_index(op.f('ix_replacements_sale_id'), table_name='replacements')
    op.drop_index(op.f('ix_replacements_return_invoice_id'), table_name='replacements')
    op.drop_index(op.f('ix_replacements_party_id'), table_name='replacements')
    op.drop_table('replacements')
    op.drop_table('production_orders')
    op.drop_index(op.f('ix_plans_slug'), table_name='plans')
    op.drop_index(op.f('ix_plans_plan_type'), table_name='plans')
    op.drop_index(op.f('ix_plans_name'), table_name='plans')
    op.drop_index(op.f('ix_plans_is_active'), table_name='plans')
    op.drop_index('idx_plans_slug', table_name='plans')
    op.drop_index('idx_plans_plan_type', table_name='plans')
    op.drop_index('idx_plans_name', table_name='plans')
    op.drop_index('idx_plans_is_public', table_name='plans')
    op.drop_index('idx_plans_is_active', table_name='plans')
    op.drop_table('plans')
    op.drop_table('permissions')
    op.drop_table('notification_templates')
    op.drop_table('integration_configs')
    op.drop_table('idempotency_keys')
    op.drop_index('ix_email_template_name_lang', table_name='email_template')
    op.drop_index(op.f('ix_email_template_name'), table_name='email_template')
    op.drop_index(op.f('ix_email_template_language_code'), table_name='email_template')
    op.drop_table('email_template')
    op.drop_index(op.f('ix_categories_name'), table_name='categories')
    op.drop_table('categories')
    op.drop_index(op.f('ix_brands_name'), table_name='brands')
    op.drop_table('brands')
    op.drop_index('ix_ai_usage_tenant_date', table_name='ai_usage')
    op.drop_table('ai_usage')
    op.drop_index(op.f('ix_ai_requests_user_id'), table_name='ai_requests')
    op.drop_index('ix_ai_requests_user_created', table_name='ai_requests')
    op.drop_index(op.f('ix_ai_requests_tenant_id'), table_name='ai_requests')
    op.drop_index('ix_ai_requests_tenant_created', table_name='ai_requests')
    op.drop_index('ix_ai_requests_status_created', table_name='ai_requests')
    op.drop_index(op.f('ix_ai_requests_session_id'), table_name='ai_requests')
    op.drop_index(op.f('ix_ai_requests_prompt_hash'), table_name='ai_requests')
    op.drop_index('ix_ai_requests_legal_hold_created', table_name='ai_requests')
    op.drop_index(op.f('ix_ai_requests_legal_hold'), table_name='ai_requests')
    op.drop_index(op.f('ix_ai_requests_idempotency_key'), table_name='ai_requests')
    op.drop_index(op.f('ix_ai_requests_created_at'), table_name='ai_requests')
    op.drop_table('ai_requests')
    op.drop_index(op.f('ix_ai_audit_logs_user_id'), table_name='ai_audit_logs')
    op.drop_index('ix_ai_audit_logs_tenant_timestamp', table_name='ai_audit_logs')
    op.drop_index(op.f('ix_ai_audit_logs_tenant_id'), table_name='ai_audit_logs')
    op.drop_index('ix_ai_audit_logs_request_timestamp', table_name='ai_audit_logs')
    op.drop_index(op.f('ix_ai_audit_logs_request_id'), table_name='ai_audit_logs')
    op.drop_index('ix_ai_audit_logs_incident_tag', table_name='ai_audit_logs')
    op.drop_index(op.f('ix_ai_audit_logs_incident_bundle_id'), table_name='ai_audit_logs')
    op.drop_index('ix_ai_audit_logs_event_type_timestamp', table_name='ai_audit_logs')
    op.drop_index(op.f('ix_ai_audit_logs_event_type'), table_name='ai_audit_logs')
    op.drop_index(op.f('ix_ai_audit_logs_action_id'), table_name='ai_audit_logs')
    op.drop_table('ai_audit_logs')
    op.drop_index(op.f('ix_affiliate_user_email'), table_name='affiliate_user')
    op.drop_table('affiliate_user')
    op.drop_index(op.f('ix_admin_users_email'), table_name='admin_users')
    op.drop_table('admin_users')
    op.drop_index(op.f('ix_admin_roles_name'), table_name='admin_roles')
    op.drop_table('admin_roles')
    op.drop_index(op.f('ix_admin_permissions_code'), table_name='admin_permissions')
    op.drop_table('admin_permissions')
    op.drop_index(op.f('ix_addons_slug'), table_name='addons')
    op.drop_index(op.f('ix_addons_name'), table_name='addons')
    op.drop_table('addons')
    # ### end Alembic commands ###
