<!DOCTYPE html>
<html>
<head>
    <title>Network Debug Test</title>
</head>
<body>
    <h1>Network Debug Test</h1>
    <p>This page tests different ways to connect to the backend.</p>
    
    <h2>Test 1: Direct Fetch (No CORS)</h2>
    <button onclick="testDirectFetch()">Test Direct Fetch</button>
    <div id="directResult"></div>
    
    <h2>Test 2: Fetch with CORS Headers</h2>
    <button onclick="testCorsFetch()">Test CORS Fetch</button>
    <div id="corsResult"></div>
    
    <h2>Test 3: Using Frontend's Axios Config</h2>
    <button onclick="testAxiosConfig()">Test Frontend Axios</button>
    <div id="axiosResult"></div>
    
    <h2>Test 4: Check Browser Console</h2>
    <p>Check the browser console for detailed network error information.</p>

    <script>
        // Test 1: Direct fetch
        async function testDirectFetch() {
            const resultDiv = document.getElementById('directResult');
            resultDiv.innerHTML = '<p>Testing direct fetch...</p>';
            
            try {
                const response = await fetch('http://localhost:5003/api/patients?per_page=1');
                const data = await response.json();
                
                resultDiv.innerHTML = `<p style="color: green;">✅ Direct fetch successful!</p>
                    <pre>${JSON.stringify(data, null, 2)}</pre>`;
            } catch (error) {
                resultDiv.innerHTML = `<p style="color: red;">❌ Direct fetch failed: ${error.message}</p>
                    <p>Error name: ${error.name}</p>
                    <p>Error code: ${error.code || 'N/A'}</p>`;
                console.error('Direct fetch error:', error);
            }
        }
        
        // Test 2: Fetch with CORS headers
        async function testCorsFetch() {
            const resultDiv = document.getElementById('corsResult');
            resultDiv.innerHTML = '<p>Testing CORS fetch...</p>';
            
            try {
                const response = await fetch('http://localhost:5003/api/patients?per_page=1', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                        'Origin': 'http://localhost:8080'
                    },
                    mode: 'cors',
                    credentials: 'include'
                });
                const data = await response.json();
                
                resultDiv.innerHTML = `<p style="color: green;">✅ CORS fetch successful!</p>
                    <pre>${JSON.stringify(data, null, 2)}</pre>`;
            } catch (error) {
                resultDiv.innerHTML = `<p style="color: red;">❌ CORS fetch failed: ${error.message}</p>
                    <p>Error name: ${error.name}</p>
                    <p>Error code: ${error.code || 'N/A'}</p>`;
                console.error('CORS fetch error:', error);
            }
        }
        
        // Test 3: Using frontend's axios config
        async function testAxiosConfig() {
            const resultDiv = document.getElementById('axiosResult');
            resultDiv.innerHTML = '<p>Testing frontend axios config...</p>';
            
            try {
                // Create axios instance similar to the frontend
                const axiosScript = document.createElement('script');
                axiosScript.src = 'https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js';
                axiosScript.onload = async function() {
                    try {
                        // Configure axios like the frontend does
                        axios.defaults.baseURL = 'http://localhost:5003';
                        axios.defaults.timeout = 10000;
                        axios.defaults.headers.common['Content-Type'] = 'application/json';
                        
                        const response = await axios.get('/api/patients?per_page=1');
                        
                        resultDiv.innerHTML = `<p style="color: green;">✅ Frontend axios config successful!</p>
                            <pre>${JSON.stringify(response.data, null, 2)}</pre>`;
                    } catch (error) {
                        resultDiv.innerHTML = `<p style="color: red;">❌ Frontend axios config failed: ${error.message}</p>
                            <p>Error name: ${error.name}</p>
                            <p>Error code: ${error.code || 'N/A'}</p>
                            <p>Error response: ${error.response ? JSON.stringify(error.response.data) : 'N/A'}</p>`;
                        console.error('Frontend axios error:', error);
                    }
                };
                document.head.appendChild(axiosScript);
            } catch (error) {
                resultDiv.innerHTML = `<p style="color: red;">❌ Failed to load axios: ${error.message}</p>`;
            }
        }
        
        // Auto-run first test
        window.onload = function() {
            console.log('Network debug test page loaded');
            console.log('Current origin:', window.location.origin);
            console.log('User agent:', navigator.userAgent);
        };
    </script>
</body>
</html>